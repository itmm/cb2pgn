<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Convert ChessBase files to PGN</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>Convert ChessBase files to PGN</h1>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">1</div><div class="headers">
<h1>Convert ChessBase files to PGN</h1>
</div></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">2</div>
<code>
<span class="macro">@Def(<span class="name">file: cb2pgn.cpp</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">includes</span>)</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">globals</span>)</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">main</span>(<span class="type">int</span> <span class="var">argc</span>, <span class="type">char</span> *<span class="var">argv</span>[]) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">main</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@End(<span class="name">file: cb2pgn.cpp</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">3</div>
<code>
<span class="macro">@def(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">cstdlib</span>&gt;<br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">iostream</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">4</div>
<code>
<span class="macro">@def(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">fail</span>(<span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">msg</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="var">msg</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="fn">exit</span>(<span class="var">EXIT_FAILURE</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">5</div>
<code>
<span class="macro">@def(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">argc</span> != <span class="num">2</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"call with cb base name"</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">6</div>
<code>
<span class="macro">@add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">fstream</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">7</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span> {<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">unit-tests</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">path</span> { <span class="var">argv</span>[<span class="num">1</span>] };<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">main_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbh"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">game_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbg"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">char</span> <span class="var">main_entry</span>[<span class="num">46</span>];<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">8</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">main_file</span>.<span class="fn">read</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span>, <span class="fn">sizeof</span>(<span class="var">main_entry</span>)<br/>
<span class="in1"></span>)) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't read header of "</span><br/>
<span class="in3"></span><span class="str">"cbh file"</span><br/>
<span class="in2"></span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">9</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="var">c</span>, <span class="type">int</span> <span class="var">len</span> = <span class="num">4</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">result</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">0</span> }; <span class="var">i</span> &lt; <span class="var">len</span>; ++<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = (<span class="var">result</span> &lt;&lt; <span class="num">8</span>) |<br/>
<span class="in4"></span>(<span class="var">c</span>[<span class="var">i</span>] &amp; <span class="num">0xff</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">10</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">count</span> { <span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">6</span>) };<br/>
<span class="in1"></span>--<span class="var">count</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"number of games: "</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">count</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">11</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (; <span class="var">main_file</span>.<span class="fn">read</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span>, <span class="fn">sizeof</span>(<span class="var">main_entry</span>)<br/>
<span class="in1"></span>); --<span class="var">count</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process game</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">12</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">to_str</span>(<span class="type">int</span> <span class="var">value</span>, <span class="type">unsigned</span> <span class="var">pad</span> = <span class="num">0</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">result</span> { <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">value</span>) };<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">result</span>.<span class="fn">size</span>() &lt; <span class="var">pad</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"0"</span> + <span class="var">result</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">13</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">count</span> == <span class="num">0</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"DONE\n"</span>;<br/>
<span class="in1"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">count</span> &gt; <span class="num">0</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"missing"</span> + <span class="fn">to_str</span>(<span class="var">count</span>) + <span class="str">" games"</span>);<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="fn">to_str</span>(-<span class="var">count</span>) + <span class="str">" surplus games"</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">14</div>
<code>
<span class="macro">@def(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">date</span> { <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span> + <span class="num">24</span>, <span class="num">3</span><br/>
<span class="in1"></span>) };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">day</span> { <span class="var">date</span> &amp; <span class="num">0x1f</span> };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">month</span> { (<span class="var">date</span> &amp; <span class="num">0x1e0</span>) &gt;&gt; <span class="num">5</span> };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">year</span> { <span class="var">date</span> &gt;&gt; <span class="num">9</span> };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">year</span> || <span class="var">month</span> || <span class="var">day</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">print date</span>)</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">15</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">to_str_not_null</span>(<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">value</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">placeholder</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">value</span> ?  <span class="fn">to_str</span>(<span class="var">value</span>,<br/>
<span class="in3"></span><span class="var">placeholder</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>) : <span class="var">placeholder</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">16</div>
<code>
<span class="macro">@def(<span class="name">print date</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Date \""</span> &lt;&lt; <br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">year</span>, <span class="str">"????"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"."</span> &lt;&lt;<br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">month</span>, <span class="str">"??"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"."</span> &lt;&lt;<br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">day</span>, <span class="str">"??"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"\"]\n"</span>;<br/>
<span class="macro">@end(<span class="name">print date</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">17</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">round</span> { <span class="var">main_entry</span>[<span class="num">29</span>] };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">round</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Round \""</span> &lt;&lt;<br/>
<span class="in3"></span><span class="fn">to_str</span>(<span class="var">round</span>) &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">18</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">result</span>;<br/>
<span class="in1"></span><span class="keyword">switch</span> (<span class="var">main_entry</span>[<span class="num">27</span>]) {<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">0</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"0-1"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">1</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"1/2-1/2"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">2</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"1-0"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">default</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"*"</span>; <span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Result \""</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">result</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">19</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">process moves</span>)</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">result</span> &lt;&lt; <span class="str">"\n\n"</span>;<br/>
<span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">20</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">istream</span> &amp;<span class="keyword">in</span>, <span class="type">int</span> <span class="var">len</span> = <span class="num">4</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">result</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">0</span> }; <span class="var">i</span> &lt; <span class="var">len</span>; ++<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = (<span class="var">result</span> &lt;&lt; <span class="num">8</span>) |<br/>
<span class="in4"></span>(<span class="keyword">in</span>.<span class="fn">get</span>() &amp; <span class="num">0xff</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">21</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">memory</span>&gt;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Position</span> {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">file_</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">rank_</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">static</span> <span class="type">int</span> <span class="fn">norm</span>(<span class="type">int</span> <span class="var">v</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">v</span> &gt; <span class="num">0</span> ? <span class="num">1</span> : <span class="var">v</span> &lt; <span class="num">0</span> ? -<span class="num">1</span> : <span class="num">0</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Position</span>() {}<br/>
<span class="in2"></span><span class="var">virtual</span> ~<span class="fn">Position</span>() {}<br/>
<span class="in2"></span><span class="fn">Position</span>(<span class="type">int</span> <span class="var">file</span>, <span class="type">int</span> <span class="var">rank</span>):<br/>
<span class="in3"></span><span class="var">file_</span> { <span class="var">file</span> },<br/>
<span class="in3"></span><span class="var">rank_</span> { <span class="var">rank</span> }<br/>
<span class="in2"></span>{}<br/>
<span class="in2"></span><span class="var">operator</span> <span class="fn">bool</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">file_</span> &gt;= <span class="num">1</span> &amp;&amp; <span class="var">file_</span> &lt;= <span class="num">8</span> &amp;&amp;<br/>
<span class="in4"></span><span class="var">rank_</span> &gt;= <span class="num">1</span> &amp;&amp; <span class="var">rank_</span> &lt;= <span class="num">8</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">int</span> <span class="fn">file</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">file_</span>; }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">file</span>(<span class="type">int</span> <span class="var">file</span>) { <span class="var">file_</span> = <span class="var">file</span>; }<br/>
<span class="in2"></span><span class="type">int</span> <span class="fn">rank</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">rank_</span>; }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">rank</span>(<span class="type">int</span> <span class="var">rank</span>) { <span class="var">rank_</span> = <span class="var">rank</span>; }<br/>
<span class="in2"></span><span class="type">Position</span> &amp;<span class="var">operator</span>+=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">o</span>) {<br/>
<span class="in3"></span><span class="var">file_</span> += <span class="var">o</span>.<span class="var">file_</span>;<br/>
<span class="in3"></span><span class="var">rank_</span> += <span class="var">o</span>.<span class="var">rank_</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> *<span class="var">this</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Position</span> &amp;<span class="var">operator</span>-=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">o</span>) {<br/>
<span class="in3"></span><span class="var">file_</span> -= <span class="var">o</span>.<span class="var">file_</span>;<br/>
<span class="in3"></span><span class="var">rank_</span> -= <span class="var">o</span>.<span class="var">rank_</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> *<span class="var">this</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">file_str</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="type">char</span> <span class="var">buffer</span>[<span class="num">2</span>] = {<br/>
<span class="in4"></span>*<span class="var">this</span> ? (<span class="type">char</span>) (<span class="str">'a'</span> + <span class="var">file_</span> - <span class="num">1</span>) : <span class="str">'?'</span>,<br/>
<span class="in4"></span><span class="str">'\0'</span><br/>
<span class="in3"></span>};<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">buffer</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">rank_str</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="type">char</span> <span class="var">buffer</span>[<span class="num">2</span>] = {<br/>
<span class="in4"></span>*<span class="var">this</span> ? (<span class="type">char</span>) (<span class="str">'1'</span> + <span class="var">rank_</span> - <span class="num">1</span>) : <span class="str">'?'</span>,<br/>
<span class="in4"></span><span class="str">'\0'</span><br/>
<span class="in3"></span>};<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">buffer</span>;<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="var">operator</span> <span class="type">std</span>::<span class="fn">string</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">file_str</span>() + <span class="fn">rank_str</span>();<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="type">Position</span> <span class="fn">norm</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Position</span> { <span class="fn">norm</span>(<span class="var">file_</span>), <span class="fn">norm</span>(<span class="var">rank_</span>) };<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="type">Position</span> <span class="fn">square</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Position</span> { <span class="var">file_</span> * <span class="var">file_</span>, <span class="var">rank_</span> * <span class="var">rank_</span> };<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">Position</span> <span class="var">operator</span>+(<span class="type">Position</span> <span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span> += <span class="var">b</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">operator</span>==(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span>.<span class="fn">file</span>() == <span class="var">b</span>.<span class="fn">file</span>() &amp;&amp; <span class="var">a</span>.<span class="fn">rank</span>() == <span class="var">b</span>.<span class="fn">rank</span>();<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">operator</span>!=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> ! (<span class="var">a</span> == <span class="var">b</span>);<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Position</span> <span class="var">operator</span>-(<span class="type">Position</span> <span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span> -= <span class="var">b</span>;<br/>
<span class="in1"></span>}<br/>
<br/>
<br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">memory</span>&gt;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Board</span>;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Piece</span>: <span class="keyword">public</span> <span class="type">Position</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">next_</span>;<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">white_</span>;<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Position</span> { <span class="var">file</span>, <span class="var">rank</span> }, <span class="var">white_</span> { <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Position</span> { <span class="var">file</span>, <span class="var">rank</span> }, <span class="var">next_</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>) }, <span class="var">white_</span> { <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="var">virtual</span> <span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>);<br/>
<span class="in2"></span><span class="var">virtual</span> <span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> = <span class="num">0</span>;<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">pawn</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="fn">name</span>().<span class="fn">empty</span>(); }<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">white</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">white_</span>; }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">next</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">next_</span>.<span class="fn">get</span>(); }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">release</span>() { <span class="keyword">return</span> <span class="var">next_</span>.<span class="fn">release</span>(); }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">reset</span>(<span class="type">Piece</span> *<span class="var">n</span>) { <span class="var">next_</span>.<span class="fn">reset</span>(<span class="var">n</span>); }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pos</span> == *<span class="var">this</span>) { <span class="keyword">return</span> <span class="var">this</span>; };<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">next</span>() ? <span class="fn">next</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">any_attacks</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">next</span>() ? <span class="fn">next</span>()-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>) : <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="type">struct</span> <span class="type">Side</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">king</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">queens</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">rooks</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">bishops</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">knights</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">pawns</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">r</span> = <span class="var">king</span>.<span class="fn">get</span>() ? <span class="var">king</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">queens</span>.<span class="fn">get</span>() ? <span class="var">queens</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">rooks</span>.<span class="fn">get</span>() ? <span class="var">rooks</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">bishops</span>.<span class="fn">get</span>() ? <span class="var">bishops</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">knights</span>.<span class="fn">get</span>() ? <span class="var">knights</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">pawns</span>.<span class="fn">get</span>() ? <span class="var">pawns</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">r</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">any_attacks</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">queens</span> &amp;&amp; <span class="var">queens</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">rooks</span> &amp;&amp; <span class="var">rooks</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">bishops</span> &amp;&amp; <span class="var">bishops</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">knights</span> &amp;&amp; <span class="var">knights</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">pawns</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">remove_inner</span>(<span class="type">Piece</span> *<span class="var">p</span>, <span class="type">Piece</span> *<span class="var">prev</span>) {<br/>
<span class="in3"></span><span class="keyword">while</span> (<span class="var">prev</span>) {<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">n</span> { <span class="var">prev</span>-&gt;<span class="fn">next</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">n</span>) {<br/>
<span class="in5"></span><span class="var">prev</span>-&gt;<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in5"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="var">prev</span> = <span class="var">n</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">remove</span>(<span class="type">Piece</span> *<span class="var">p</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">king</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">king</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">king</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">queens</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">queens</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">queens</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">rooks</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">rooks</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">rooks</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">bishops</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">bishops</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">bishops</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">knights</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">knights</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">knights</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Board</span> {<br/>
<span class="in2"></span><span class="type">Side</span> <span class="var">white_</span>;<br/>
<span class="in2"></span><span class="type">Side</span> <span class="var">black_</span>;<br/>
<span class="in2"></span><span class="type">Side</span> *<span class="var">cur_</span> { &amp;<span class="var">white_</span> };<br/>
<span class="in2"></span><span class="type">Side</span> *<span class="var">other_</span> { &amp;<span class="var">black_</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">Piece</span> *<span class="var">pcs</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="fn">Board</span>(<span class="type">const</span> <span class="type">Board</span> &amp;) = <span class="keyword">delete</span>;<br/>
<span class="in2"></span><span class="type">Board</span> &amp;<span class="var">operator</span>=(<span class="type">const</span> <span class="type">Board</span> &amp;) = <span class="keyword">delete</span>;<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Board</span>();<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">king</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">queen</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">bishop</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">knight</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">rook</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">pawn</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">get</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) { <br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="var">white_</span>.<span class="fn">find</span>(<span class="var">pos</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">black_</span>.<span class="fn">find</span>(<span class="var">pos</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">move</span>(<span class="type">Piece</span> *<span class="var">first</span>, <span class="type">Piece</span> *<span class="var">from</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>);<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">switch_players</span>() { <br/>
<span class="in3"></span><span class="type">Side</span> *<span class="var">tmp</span> { <span class="var">other_</span> };<br/>
<span class="in3"></span><span class="var">other_</span> = <span class="var">cur_</span>;<br/>
<span class="in3"></span><span class="var">cur_</span> = <span class="var">tmp</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">white</span>() <span class="type">const</span> { <span class="keyword">return</span> &amp;<span class="var">white_</span> == <span class="var">cur_</span>; }<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">mate</span>() { <br/>
<span class="in3"></span><span class="type">Piece</span> &amp;<span class="var">k</span> { *<span class="var">other_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>() };<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">r</span> { -<span class="num">1</span> }; <span class="var">r</span> &lt;= <span class="num">1</span>; ++<span class="var">r</span>) {<br/>
<span class="in4"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">f</span> { -<span class="num">1</span> }; <span class="var">f</span> &lt;= <span class="num">1</span>; ++<span class="var">f</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (! <span class="var">r</span> &amp;&amp; ! <span class="var">f</span>) { <span class="keyword">continue</span>; }<br/>
<span class="in5"></span><span class="type">Position</span> <span class="var">to</span> {<span class="var">k</span> + <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> }};<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">to</span> &amp;&amp; <span class="var">k</span>.<span class="fn">can_move_to</span>(*<span class="var">this</span>, <span class="var">to</span>)) {<br/>
<span class="in6"></span><span class="keyword">if</span> (! <span class="var">cur_</span>-&gt;<span class="fn">any_attacks</span>(*<span class="var">this</span>, <span class="var">to</span>)) {<br/>
<span class="in7"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in6"></span>}<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">check</span>() { <br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">any_attacks</span>(*<span class="var">this</span>, *<span class="var">other_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>());<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">kingside_rochade</span>();<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">queenside_rochade</span>();<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">remove</span>(<span class="type">Piece</span> *<span class="var">piece</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">piece</span>-&gt;<span class="fn">pawn</span>()) {<br/>
<span class="in4"></span><span class="var">piece</span>-&gt;<span class="fn">file</span>(<span class="num">0</span>);<br/>
<span class="in4"></span><span class="var">piece</span>-&gt;<span class="fn">rank</span>(<span class="num">0</span>);<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">name</span> { <span class="var">piece</span>-&gt;<span class="fn">name</span>() + (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">piece</span> };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">white_</span>.<span class="fn">remove</span>(<span class="var">piece</span>)) { <span class="keyword">return</span>; };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">black_</span>.<span class="fn">remove</span>(<span class="var">piece</span>)) { <span class="keyword">return</span>; }<br/>
<span class="in4"></span><span class="fn">fail</span>(<span class="str">"can't remove piece "</span> + <span class="var">name</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>} <span class="var">brd</span>;<br/>
<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">find</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">Piece</span> *<span class="var">pcs</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">for</span> (; <span class="var">nr</span> &gt; <span class="num">1</span> &amp;&amp; <span class="var">pcs</span>; --<span class="var">nr</span>) {<br/>
<span class="in3"></span><span class="var">pcs</span> = <span class="var">pcs</span>-&gt;<span class="fn">next</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">pcs</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">king</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">queen</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">queens</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">queens</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">bishop</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">bishops</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">bishops</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">knight</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">knights</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">knights</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">rook</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">pawn</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">pawns</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">pawns</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">move</span>(<span class="type">Piece</span> *<span class="var">first</span>, <span class="type">Piece</span> *<span class="var">from</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">from</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no piece to move from"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">captures</span> { <span class="var">to_piece</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">from</span>-&gt;<span class="fn">pawn</span>() &amp;&amp; <span class="var">from</span>-&gt;<span class="fn">file</span>() != <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="var">captures</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">white</span>()) {<br/>
<span class="in5"></span><span class="var">to_piece</span> = <span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span> { <span class="num">0</span>, -<span class="num">1</span> });<br/>
<span class="in4"></span>} <span class="keyword">else</span> {<br/>
<span class="in5"></span><span class="var">to_piece</span> = <span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span> { <span class="num">0</span>, <span class="num">1</span> });<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="var">captures</span> = <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">name</span>();// &lt;&lt; <span class="str">'('</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">from</span> &lt;&lt; <span class="str">')'</span>;<br/>
<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">from</span>-&gt;<span class="fn">pawn</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">captures</span>) {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">file_str</span>();<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">same_f</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">same_r</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">multiple</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">cur</span> { <span class="var">first</span> }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span> == <span class="var">from</span>) { <span class="keyword">continue</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">cur</span>-&gt;<span class="fn">can_move_to</span>(*<span class="var">this</span>, <span class="var">to</span>)) { <span class="keyword">continue</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">file</span>() == <span class="var">from</span>-&gt;<span class="fn">file</span>()) { <span class="var">same_f</span> = <span class="num">true</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">rank</span>() == <span class="var">from</span>-&gt;<span class="fn">rank</span>()) { <span class="var">same_r</span> = <span class="num">true</span>; }<br/>
<span class="in4"></span><span class="var">multiple</span> = <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">multiple</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">same_f</span> || (<span class="var">same_f</span> &amp;&amp; <span class="var">same_r</span>)) {<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">file_str</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">same_f</span>) {<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">rank_str</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">captures</span>) { <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"x"</span>; }<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) {<br/>
<span class="in3"></span><span class="fn">remove</span>(<span class="var">to_piece</span>);<br/>
<span class="in3"></span><span class="var">to_piece</span> = <span class="num">nullptr</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">from</span>-&gt;<span class="fn">file</span>(<span class="var">to</span>.<span class="fn">file</span>());<br/>
<span class="in2"></span><span class="var">from</span>-&gt;<span class="fn">rank</span>(<span class="var">to</span>.<span class="fn">rank</span>());<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) <span class="var">to</span>;<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="fn">check</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">mate</span>()) {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'#'</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'+'</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span>;<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">bool</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to_piece</span> &amp;&amp; <span class="var">to_piece</span>-&gt;<span class="fn">white</span>() == <span class="var">white_</span>) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in2"></span><br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">d</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">norm</span>() };<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">cur</span> { *<span class="var">this</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (;;) {<br/>
<span class="in3"></span><span class="var">cur</span> = <span class="var">cur</span> + <span class="var">d</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="var">cur</span>) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">cur</span> == <span class="var">to</span>) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">brd</span>.<span class="fn">get</span>(<span class="var">cur</span>)) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Rook_Piece</span>: <span class="keyword">public</span> <span class="var">virtual</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Rook_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Rook_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span>//<span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"{R"</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">this</span> &lt;&lt; <span class="str">" -&gt; "</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) <span class="var">to</span> &lt;&lt; <span class="str">": "</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">file</span>() == <span class="fn">file</span>() || <span class="var">to</span>.<span class="fn">rank</span>() == <span class="fn">rank</span>()) {<br/>
<span class="in4"></span>//<span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>) &lt;&lt; <span class="str">" (+)} "</span>;<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span>//<span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">" false} "</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"R"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Bishop_Piece</span>: <span class="keyword">public</span> <span class="var">virtual</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Bishop_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Bishop_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">d</span> { <span class="var">to</span> - *<span class="var">this</span> };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">d</span>.<span class="fn">file</span>() == <span class="var">d</span>.<span class="fn">rank</span>() || <span class="var">d</span>.<span class="fn">file</span>() == -<span class="var">d</span>.<span class="fn">rank</span>()) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"B"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Queen_Piece</span>: <span class="keyword">public</span> <span class="type">Rook_Piece</span>, <span class="keyword">public</span> <span class="type">Bishop_Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Queen_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Queen_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Rook_Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>) ||<br/>
<span class="in4"></span><span class="type">Bishop_Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"Q"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">King_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">King_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">King_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() &lt;= <span class="num">1</span> &amp;&amp; <span class="var">sq</span>.<span class="fn">rank</span>() &lt;= <span class="num">1</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"K"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Knight_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Knight_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Knight_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() + <span class="var">sq</span>.<span class="fn">rank</span>() == <span class="num">5</span> &amp;&amp; (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span> || <span class="var">sq</span>.<span class="fn">rank</span>() == <span class="num">1</span>)) {<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">to_piece</span> &amp;&amp; <span class="var">to_piece</span>-&gt;<span class="fn">white</span>() == <span class="fn">white</span>()) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in4"></span><br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>};<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"N"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">White_Pawn_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">White_Pawn_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="num">true</span> } {}<br/>
<span class="in2"></span><span class="fn">White_Pawn_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="num">true</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">2</span> &amp;&amp; <span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">4</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>() &amp;&amp; ! <span class="var">to_piece</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">rank</span>() + <span class="num">1</span> == <span class="var">to</span>.<span class="fn">rank</span>()) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in5"></span><span class="keyword">return</span> ! <span class="var">to_piece</span>;<br/>
<span class="in4"></span>};<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) { <span class="keyword">return</span> ! <span class="var">to_piece</span>-&gt;<span class="fn">white</span>(); }<br/>
<span class="in5"></span><span class="type">Piece</span> *<span class="var">p</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span>{<span class="num">0</span>, <span class="num">1</span>}) };<br/>
<span class="in5"></span><span class="keyword">return</span> <span class="var">p</span> &amp;&amp; ! <span class="var">p</span>-&gt;<span class="fn">white</span>() &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">pawn</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">""</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Black_Pawn_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Black_Pawn_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="num">false</span> } {}<br/>
<span class="in2"></span><span class="fn">Black_Pawn_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="num">false</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">7</span> &amp;&amp; <span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">5</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>() &amp;&amp; ! <span class="var">to_piece</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">rank</span>() - <span class="num">1</span> == <span class="var">to</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in5"></span><span class="keyword">return</span> ! <span class="var">to_piece</span>;<br/>
<span class="in4"></span>};<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) { <span class="keyword">return</span> <span class="var">to_piece</span>-&gt;<span class="fn">white</span>(); }<br/>
<span class="in5"></span><span class="type">Piece</span> *<span class="var">p</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span>{<span class="num">0</span>, -<span class="num">1</span>}) };<br/>
<span class="in5"></span><span class="keyword">return</span> <span class="var">p</span> &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">white</span>() &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">pawn</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">""</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="type">Board</span>::<span class="fn">Board</span>() {<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">king</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">King_Piece</span>&gt;(<span class="num">5</span>, <span class="num">1</span>, <span class="num">true</span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">king</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">King_Piece</span>&gt;(<span class="num">5</span>, <span class="num">8</span>, <span class="num">false</span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">queens</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Queen_Piece</span>&gt;(<span class="num">4</span>, <span class="num">1</span>, <span class="num">true</span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">queens</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Queen_Piece</span>&gt;(<span class="num">4</span>, <span class="num">8</span>, <span class="num">false</span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">rooks</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<span class="num">8</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">1</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">rooks</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<span class="num">8</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">1</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">bishops</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<span class="num">6</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">3</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">bishops</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<span class="num">6</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">3</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">knights</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<span class="num">7</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">2</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">knights</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<span class="num">7</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">2</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">8</span> }; <span class="var">i</span> &gt; <span class="num">0</span>; --<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">white_</span>.<span class="var">pawns</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">White_Pawn_Piece</span>&gt;(<br/>
<span class="in4"></span><span class="type">std</span>::<span class="fn">move</span>(<span class="var">white_</span>.<span class="var">pawns</span>), <span class="var">i</span>, <span class="num">2</span><br/>
<span class="in3"></span>);<br/>
<span class="in3"></span><span class="var">black_</span>.<span class="var">pawns</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Black_Pawn_Piece</span>&gt;(<br/>
<span class="in4"></span><span class="type">std</span>::<span class="fn">move</span>(<span class="var">black_</span>.<span class="var">pawns</span>), <span class="var">i</span>, <span class="num">7</span><br/>
<span class="in3"></span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">22</div>
<code>
<span class="macro">@def(<span class="name">unit-tests</span>)</span> <br/>
<span class="in1"></span><span class="type">Board</span> <span class="var">brd</span>;<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">23</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_1_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">nr</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">pc</span> { (<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="var">nr</span>, <span class="var">other</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">pc</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no figure at index "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">pcs</span> { (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">pc</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">pcs</span> != <span class="var">exp</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"got "</span> + <span class="var">pcs</span> + <span class="str">" but expecting "</span> + <span class="var">exp</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_1_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">2</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than one piece"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">24</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">false</span>, <span class="str">"e1"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">true</span>, <span class="str">"e8"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="num">false</span>, <span class="str">"d1"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="num">true</span>, <span class="str">"d8"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">25</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_2_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_1</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_2</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp_1</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">2</span>, <span class="var">other</span>, <span class="var">exp_2</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">3</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than two pieces"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span>;<br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">26</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="num">false</span>, <span class="str">"a1"</span>, <span class="str">"h1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="num">true</span>, <span class="str">"a8"</span>, <span class="str">"h8"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="num">false</span>, <span class="str">"b1"</span>, <span class="str">"g1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="num">true</span>, <span class="str">"b8"</span>, <span class="str">"g8"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="num">false</span>, <span class="str">"c1"</span>, <span class="str">"f1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="num">true</span>, <span class="str">"c8"</span>, <span class="str">"f8"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">27</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_8_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_1</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_2</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_3</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_4</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_5</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_6</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_7</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_8</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp_1</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">2</span>, <span class="var">other</span>, <span class="var">exp_2</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">3</span>, <span class="var">other</span>, <span class="var">exp_3</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">4</span>, <span class="var">other</span>, <span class="var">exp_4</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">5</span>, <span class="var">other</span>, <span class="var">exp_5</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">6</span>, <span class="var">other</span>, <span class="var">exp_6</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">7</span>, <span class="var">other</span>, <span class="var">exp_7</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">8</span>, <span class="var">other</span>, <span class="var">exp_8</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">9</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than 8 pieces"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">28</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_8_fig</span>(&amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="num">false</span>, <span class="str">"a2"</span>, <span class="str">"b2"</span>, <span class="str">"c2"</span>, <span class="str">"d2"</span>, <span class="str">"e2"</span>, <span class="str">"f2"</span>, <span class="str">"g2"</span>, <span class="str">"h2"</span>);<br/>
<span class="in1"></span><span class="fn">test_8_fig</span>(&amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="num">true</span>, <span class="str">"a7"</span>, <span class="str">"b7"</span>, <span class="str">"c7"</span>, <span class="str">"d7"</span>, <span class="str">"e7"</span>, <span class="str">"f7"</span>, <span class="str">"g7"</span>, <span class="str">"h7"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">29</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_add</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>, <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span>) {<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">q</span> { <span class="var">p</span> + <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> } };<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">got</span> { (<span class="type">std</span>::<span class="type">string</span>) <span class="var">q</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">got</span> != <span class="var">exp</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"adding returns "</span> + <span class="var">got</span> + <span class="str">" instead of "</span> + <span class="var">exp</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">30</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span> {<br/>
<span class="in1"></span><span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">wk</span> { *<span class="var">brd</span>.<span class="fn">king</span>() };<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, <span class="num">0</span>, <span class="num">0</span>, <span class="str">"e1"</span>);<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, -<span class="num">4</span>, <span class="num">0</span>, <span class="str">"a1"</span>);<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="str">"h1"</span>);<br/>
} <span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">31</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">move_piece</span>(<span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">from</span> { (<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="var">nr</span>, <span class="num">false</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">from</span>) { <span class="fn">fail</span>(<span class="str">"no piece to move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>)); }<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">to</span> { *<span class="var">from</span> + <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> } };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">file</span>() &gt; <span class="num">8</span>) { <span class="var">to</span> -= <span class="type">Position</span> { <span class="num">8</span>, <span class="num">0</span> }; }<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">rank</span>() &gt; <span class="num">8</span>) { <span class="var">to</span> -= <span class="type">Position</span> { <span class="num">0</span>, <span class="num">8</span> }; }<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">to</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">brd</span>.<span class="fn">move</span>((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">1</span>, <span class="num">false</span>), <span class="var">from</span>, <span class="var">to</span>);<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">32</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_king</span>(<span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">1</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid king move"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">33</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_queen</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid queen move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">34</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_rook</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid rook move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">35</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_bishop</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid bishop move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">36</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_knight</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid knight move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">37</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_pawn</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">white</span>()) {<br/>
<span class="in3"></span><span class="var">r</span> = <span class="num">8</span> - <span class="var">r</span>;<br/>
<span class="in3"></span><span class="var">f</span> = <span class="var">f</span> ? <span class="num">8</span> - <span class="var">f</span> : <span class="num">0</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(&amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid pawn move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>) + <span class="str">", "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">f</span>) + <span class="str">", "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">r</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">38</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">kingside_rochade</span>() {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">kp</span> { <span class="fn">king</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">kf</span> { <span class="var">kp</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">mf</span> { <span class="num">9</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="num">nullptr</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">Piece</span> *<span class="var">cur</span> { <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">rank</span>() != <span class="var">kp</span>-&gt;<span class="fn">rank</span>()) { <span class="keyword">continue</span>; }<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">pf</span> { <span class="var">cur</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pf</span> &gt; <span class="var">kf</span> &amp;&amp; <span class="var">pf</span> &lt; <span class="var">mf</span>) {<br/>
<span class="in4"></span><span class="var">mf</span> = <span class="var">pf</span>;<br/>
<span class="in4"></span><span class="var">r</span> = <span class="var">cur</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">r</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no kingside rook found"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">r</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> + <span class="num">1</span>);<br/>
<span class="in2"></span><span class="var">kp</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> + <span class="num">2</span>);<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"O-O "</span>;<br/>
<span class="in2"></span>/*<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"{ "</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">kp</span> &lt;&lt; <span class="str">" "</span>;<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">Piece</span> *<span class="var">cur</span> { <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">cur</span> &lt;&lt; <span class="str">' '</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"} "</span>;<br/>
<span class="in2"></span>*/<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">39</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">queenside_rochade</span>() {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">kp</span> { <span class="fn">king</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">kf</span> { <span class="var">kp</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">mf</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="num">nullptr</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">Piece</span> *<span class="var">cur</span> { <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">pf</span> { <span class="var">cur</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pf</span> &lt; <span class="var">kf</span> &amp;&amp; <span class="var">pf</span> &gt; <span class="var">mf</span>) {<br/>
<span class="in4"></span><span class="var">mf</span> = <span class="var">pf</span>;<br/>
<span class="in4"></span><span class="var">r</span> = <span class="var">cur</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">r</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no queenside rook found"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">nr</span> { *<span class="var">kp</span> + <span class="type">Position</span> { -<span class="num">1</span>, <span class="num">0</span> } };<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">nk</span> { *<span class="var">kp</span> + <span class="type">Position</span> { -<span class="num">2</span>, <span class="num">0</span> } };<br/>
<span class="in2"></span><span class="var">r</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> - <span class="num">1</span>);<br/>
<span class="in2"></span><span class="var">kp</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> - <span class="num">2</span>);<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"O-O-O "</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">40</div>
<code>
<span class="macro">@def(<span class="name">process moves</span>)</span> {<br/>
<span class="in1"></span><span class="var">brd</span>.~<span class="fn">Board</span>();<br/>
<span class="in1"></span><span class="keyword">new</span> (&amp;<span class="var">brd</span>) <span class="fn">Board</span>();<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">game_file</span>.<span class="fn">seekg</span>(<span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">1</span>), <span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">beg</span>)) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't move to game at "</span> + <span class="fn">to_str</span>(<span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">1</span>)));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">len</span> { <span class="fn">get_int</span>(<span class="var">game_file</span>) };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">len</span> &amp; <span class="num">0x80000000</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"unknown game data of length "</span> + <span class="fn">to_str</span>(<span class="var">len</span>));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">len</span> &amp; <span class="num">0x40000000</span>) {<br/>
<span class="in2"></span><span class="var">len</span> &amp;= <span class="num">0x3fffffff</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[SetUp \"1\"]\n"</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[FEN \"xx\"]\n"</span>;<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">28</span> }; <span class="var">i</span>; --<span class="var">i</span>) { <span class="var">game_file</span>.<span class="fn">get</span>(); }<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">count</span> { <span class="num">0</span> }, <span class="var">nr</span> { <span class="num">0</span> }; <span class="var">len</span>; ++<span class="var">count</span>, ++<span class="var">nr</span>, --<span class="var">len</span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">ch</span> { (<span class="var">game_file</span>.<span class="fn">get</span>() - <span class="var">count</span>) &amp; <span class="num">0xff</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="num">0x0c</span>) {<br/>
<span class="in3"></span><span class="keyword">break</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! (<span class="var">nr</span> &amp; <span class="num">1</span>)) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; (<span class="num">1</span> + (<span class="var">nr</span> &gt;&gt; <span class="num">1</span>)) &lt;&lt; <span class="str">". "</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>//<span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'['</span> &lt;&lt; <span class="var">count</span> &lt;&lt; <span class="str">", "</span> &lt;&lt; <span class="var">len</span> &lt;&lt; <span class="str">", "</span> &lt;&lt; <span class="var">nr</span> &lt;&lt; <span class="str">"] "</span>;<br/>
<span class="in2"></span>//<span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'{'</span> &lt;&lt; <span class="type">std</span>::<span class="var">hex</span> &lt;&lt; <span class="var">ch</span> &lt;&lt; <span class="type">std</span>::<span class="var">dec</span> &lt;&lt; <span class="str">"} "</span>;<br/>
<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">ch</span>) {<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x02</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x05</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x06</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x07</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x08</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x09</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">6</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0b</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">4</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0e</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x12</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">8</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x13</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">8</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x14</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x15</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">5</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x16</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x17</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x18</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x19</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">8</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x21</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x24</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x26</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x28</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2c</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2d</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2e</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x30</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x32</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x33</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">8</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x34</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">2</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x35</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x36</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">5</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x37</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x39</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3a</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">7</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3d</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3f</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x41</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x43</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x47</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(-<span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x48</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x49</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4a</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4e</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x52</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x53</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x55</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x57</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x58</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5d</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="num">1</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5e</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5f</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">6</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x61</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x62</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x63</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x64</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x68</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6b</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6d</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6e</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6f</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x70</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x71</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x73</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x75</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">6</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x76</span>:<br/>
<span class="in4"></span><span class="var">brd</span>.<span class="fn">kingside_rochade</span>();<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x77</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x78</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x79</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7b</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">3</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7c</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7d</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">6</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x84</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">5</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x85</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">3</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x88</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x89</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8b</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8e</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x90</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">4</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x93</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x96</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x97</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x98</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x99</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9c</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9e</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">6</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa1</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa2</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa4</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa5</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa7</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa9</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xae</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb1</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(-<span class="num">1</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb2</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(-<span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb4</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb5</span>:<br/>
<span class="in4"></span><span class="var">brd</span>.<span class="fn">queenside_rochade</span>();<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb7</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb8</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd9</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xba</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbb</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">7</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbc</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">7</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbd</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbe</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbf</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc1</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc2</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="num">0</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc3</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc4</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">2</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc5</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">4</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xcb</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd2</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd4</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd7</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd8</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xde</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">6</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xda</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">3</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xdd</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">1</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xdf</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">7</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe0</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">3</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe1</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe2</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe4</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe9</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">6</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xeb</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="num">1</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xee</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf2</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf3</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf5</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf6</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="num">2</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf8</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf9</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">4</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfa</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">1</span>, <span class="num">7</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfb</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="num">2</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfe</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="num">2</span>, <span class="num">7</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xff</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="num">5</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">default</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">code</span>;<br/>
<span class="in4"></span><span class="type">const</span> <span class="type">char</span> <span class="var">digits</span>[] = <span class="str">"0123456789abcdef"</span>;<br/>
<span class="in4"></span><span class="var">code</span> += <span class="var">digits</span>[<span class="var">ch</span> &gt;&gt; <span class="num">4</span>];<br/>
<span class="in4"></span><span class="var">code</span> += <span class="var">digits</span>[<span class="var">ch</span> &amp; <span class="num">0xf</span>];<br/>
<span class="in4"></span><span class="fn">fail</span>(<span class="str">"unknown code 0x"</span> + <span class="var">code</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">brd</span>.<span class="fn">switch_players</span>();<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process moves</span>)</span><br/>
</code></div>
</div>
</body>
</html>
