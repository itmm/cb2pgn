<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Convert ChessBase files to PGN</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>Convert ChessBase files to PGN</h1>
<div class="slides">
<div class="page">
<div class="slide"><div class="slide-nr">1</div><div class="headers">
<h1>Convert ChessBase files to PGN</h1>
</div></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">2</div>
<code>
<span class="macro">@Def(<span class="name">file: cb2pgn.cpp</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">includes</span>)</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">globals</span>)</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">main</span>(<span class="type">int</span> <span class="var">argc</span>, <span class="type">char</span> *<span class="var">argv</span>[]) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">main</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@End(<span class="name">file: cb2pgn.cpp</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">3</div>
<code>
<span class="macro">@def(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">cstdlib</span>&gt;<br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">iostream</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">4</div>
<code>
<span class="macro">@def(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">fail</span>(<span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">msg</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="var">msg</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="fn">exit</span>(<span class="var">EXIT_FAILURE</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">5</div>
<code>
<span class="macro">@def(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">argc</span> != <span class="num">2</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"call with cb base name"</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">6</div>
<code>
<span class="macro">@add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">fstream</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">7</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span> {<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">unit-tests</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">path</span> { <span class="var">argv</span>[<span class="num">1</span>] };<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">main_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbh"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">game_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbg"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">player_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbp"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">ifstream</span> <span class="var">tournament_file</span> {<br/>
<span class="in2"></span>(<span class="var">path</span> + <span class="str">".cbt"</span>).<span class="fn">c_str</span>(),<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">binary</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">char</span> <span class="var">main_entry</span>[<span class="num">46</span>];<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">8</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">main_file</span>.<span class="fn">read</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span>, <span class="fn">sizeof</span>(<span class="var">main_entry</span>)<br/>
<span class="in1"></span>)) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't read header of "</span><br/>
<span class="in3"></span><span class="str">"cbh file"</span><br/>
<span class="in2"></span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">9</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="var">c</span>, <span class="type">int</span> <span class="var">len</span> = <span class="num">4</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">result</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">0</span> }; <span class="var">i</span> &lt; <span class="var">len</span>; ++<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = (<span class="var">result</span> &lt;&lt; <span class="num">8</span>) |<br/>
<span class="in4"></span>(<span class="var">c</span>[<span class="var">i</span>] &amp; <span class="num">0xff</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">10</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">count</span> { <span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">6</span>) };<br/>
<span class="in1"></span>--<span class="var">count</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"number of games: "</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">count</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">11</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (; <span class="var">main_file</span>.<span class="fn">read</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span>, <span class="fn">sizeof</span>(<span class="var">main_entry</span>)<br/>
<span class="in1"></span>); --<span class="var">count</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process game</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">12</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">to_str</span>(<span class="type">int</span> <span class="var">value</span>, <span class="type">unsigned</span> <span class="var">pad</span> = <span class="num">0</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">result</span> { <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">value</span>) };<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">result</span>.<span class="fn">size</span>() &lt; <span class="var">pad</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"0"</span> + <span class="var">result</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">13</div>
<code>
<span class="macro">@add(<span class="name">main</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">count</span> &gt; <span class="num">0</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"missing"</span> + <span class="fn">to_str</span>(<span class="var">count</span>) + <span class="str">" games"</span>);<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="fn">to_str</span>(-<span class="var">count</span>) + <span class="str">" surplus games"</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">main</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">14</div>
<code>
<span class="macro">@def(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Event \""</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">nr</span> { <span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">15</span>, <span class="num">3</span>) };<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">tournament_file</span>.<span class="fn">seekg</span>(<span class="num">32</span> + <span class="num">99</span> * <span class="var">nr</span>, <span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">beg</span>)) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't move to tournament "</span> + <span class="fn">to_str</span>(<span class="var">nr</span>));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">char</span> <span class="var">entry</span>[<span class="num">99</span>];<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">tournament_file</span>.<span class="fn">read</span>(<span class="var">entry</span>, <span class="fn">sizeof</span>(<span class="var">entry</span>))) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't read tournament "</span> + <span class="fn">to_str</span>(<span class="var">nr</span>));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">char</span> *<span class="var">c</span> { <span class="var">entry</span> + <span class="num">9</span> }; *<span class="var">c</span> &amp;&amp; <span class="var">c</span> &lt; <span class="var">entry</span> + <span class="num">49</span>; ++<span class="var">c</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; *<span class="var">c</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">entry</span>[<span class="num">9</span>]) { <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'?'</span>; }<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Site \""</span>;<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">char</span> *<span class="var">c</span> { <span class="var">entry</span> + <span class="num">49</span> }; *<span class="var">c</span> &amp;&amp; <span class="var">c</span> &lt; <span class="var">entry</span> + <span class="num">79</span>; ++<span class="var">c</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; *<span class="var">c</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">entry</span>[<span class="num">49</span>]) { <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'?'</span>; }<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">entry</span>[<span class="num">83</span>] &amp; <span class="num">0xff</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span>;<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">entry</span>[<span class="num">83</span>]) {<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">1</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AFG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">2</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ALB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">3</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ALG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">4</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ANG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">5</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AND"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">6</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ANT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">7</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ARG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">8</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ARM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">9</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AUS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">10</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AUT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">11</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AZE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">12</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BAH"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">13</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BHN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">14</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BAN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">15</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BAR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">16</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BLR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">17</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BEL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">18</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BLZ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">19</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BER"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">20</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BOL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">21</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BIH"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">22</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BOT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">23</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BRA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">24</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IVB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">25</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BRU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">26</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BUL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">27</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BUR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">28</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CAN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">29</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CHI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">30</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CHN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">31</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"COL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">32</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">33</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CRO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">34</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CUB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">35</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CYP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">36</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CZE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">37</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"DEN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">38</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"DJI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">39</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"DOM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">40</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ECU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">41</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"EGY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">42</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ENG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">43</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ESP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">44</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"EST"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">45</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ETH"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">46</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FAI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">47</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FIJ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">48</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FIN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">49</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FRA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">50</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FRM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">51</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">52</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GEO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">53</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GER"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">54</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GHA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">55</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GRE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">56</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GUA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">57</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GCI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">58</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GUY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">59</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"HAI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">60</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"HON"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">61</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"HKG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">62</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"HUN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">63</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ISL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">64</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IND"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">65</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"INA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">66</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">67</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IRQ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">68</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ISR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">69</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IRL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">70</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ITA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">71</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IVO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">72</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"JAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">73</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"JPN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">74</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"JCI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">75</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"JOR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">76</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KAZ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">77</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KEN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">78</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KOR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">79</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KGZ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">80</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KUW"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">81</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LAT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">82</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LBN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">83</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LBY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">84</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LIE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">85</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LTU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">86</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LUX"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">87</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MAC"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">88</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MAD"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">89</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MAS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">90</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MLI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">91</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MLT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">92</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MAU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">93</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">94</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MEX"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">95</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MDA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">96</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MNC"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">97</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MGL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">98</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MAR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">99</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MOZ"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">100</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MYA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">101</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">102</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NEP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">103</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NED"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">104</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AHO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">105</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NZL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">106</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NCA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">107</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NGR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">108</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NOR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">109</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PAK"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">110</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PLE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">111</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PAN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">112</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PNG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">113</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PAR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">114</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PER"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">115</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PHI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">116</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"POL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">117</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"POR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">118</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PUR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">119</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"QAT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">120</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ROM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">121</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"RUS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">122</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ESA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">123</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SMR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">124</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SCO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">125</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SEN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">126</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SEY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">127</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SIN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">128</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SVK"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">129</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SLO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">130</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"RSA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">131</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">132</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SUD"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">133</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SUR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">134</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SWE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">135</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SUI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">136</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SYR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">137</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TJK"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">138</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TAN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">139</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"THA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">140</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">141</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TUN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">142</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TUR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">143</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TKM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">144</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"UGA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">145</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"UKR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">146</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"UAE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">147</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"USA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">148</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"URU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">149</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"URS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">150</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"UZB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">151</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"VEN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">152</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"VIE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">153</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ISV"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">154</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"WLS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">155</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"YEM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">156</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"YUG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">157</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ZAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">158</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ZIM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">159</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ZRE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">160</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"DDR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">161</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CSR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">162</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">163</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CHD"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">164</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KAP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">165</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KBA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">166</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"COM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">167</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CON"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">168</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NKO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">169</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LAO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">170</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LES"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">171</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MWI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">172</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MDV"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">173</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MSH"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">174</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"OMN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">175</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NAU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">176</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MIC"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">177</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NIG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">178</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SAU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">179</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TOG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">180</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TON"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">181</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"VAN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">182</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"VAT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">183</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TUV"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">184</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SWA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">185</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SIE"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">186</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SLU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">187</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PAP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">188</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SVI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">189</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SAM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">190</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SKI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">191</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SAL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">192</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GE2"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">193</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ZAR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">194</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"RWA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">195</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"LBR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">196</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NET"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">197</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TWN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">198</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ASU"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">199</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"AGG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">200</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BNN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">201</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BTN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">202</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BRI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">203</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CMB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">204</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CAY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">205</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CAR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">206</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CIB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">207</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CIA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">208</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"COA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">209</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CIN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">210</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ELG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">211</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ERI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">212</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FGB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">213</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FRG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">214</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FRP"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">215</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GAB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">216</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GGB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">217</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GRA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">218</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GRL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">219</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"FGA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">220</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GMA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">221</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GUI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">222</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GUB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">223</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"IOM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">224</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"JMY"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">225</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MFR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">226</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MYF"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">227</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MSG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">228</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NCF"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">229</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NNN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">230</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NNA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">231</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NMI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">232</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"OTM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">233</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PAL"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">234</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PIG"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">235</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"RUF"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">236</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SAO"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">237</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SOM"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">238</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SVN"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">239</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"HGB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">240</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"PGB"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">241</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TKI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">242</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"TCI"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">243</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"WFR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">244</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"NIR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">245</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"ISS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">246</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"GBR"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">247</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SAA"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">248</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"MNT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">249</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"SER"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">250</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"CAT"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">251</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"BAS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">252</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"KOS"</span>; <span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">default</span>: <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"???"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">15</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">date</span> { <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="var">main_entry</span> + <span class="num">24</span>, <span class="num">3</span><br/>
<span class="in1"></span>) };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">day</span> { <span class="var">date</span> &amp; <span class="num">0x1f</span> };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">month</span> { (<span class="var">date</span> &amp; <span class="num">0x1e0</span>) &gt;&gt; <span class="num">5</span> };<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">year</span> { <span class="var">date</span> &gt;&gt; <span class="num">9</span> };<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">print date</span>)</span>;<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">16</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">to_str_not_null</span>(<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">value</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">placeholder</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">value</span> ?  <span class="fn">to_str</span>(<span class="var">value</span>,<br/>
<span class="in3"></span><span class="var">placeholder</span>.<span class="fn">size</span>()<br/>
<span class="in2"></span>) : <span class="var">placeholder</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">17</div>
<code>
<span class="macro">@def(<span class="name">print date</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Date \""</span> &lt;&lt; <br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">year</span>, <span class="str">"????"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"."</span> &lt;&lt;<br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">month</span>, <span class="str">"??"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"."</span> &lt;&lt;<br/>
<span class="in2"></span><span class="fn">to_str_not_null</span>(<span class="var">day</span>, <span class="str">"??"</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">"\"]\n"</span>;<br/>
<span class="macro">@end(<span class="name">print date</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">18</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">round</span> { <span class="var">main_entry</span>[<span class="num">29</span>] };<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Round \""</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; (<span class="var">round</span> ? <span class="fn">to_str</span>(<span class="var">round</span>) : <span class="str">"?"</span>);<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">sub_round</span> { <span class="var">main_entry</span>[<span class="num">30</span>] };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">sub_round</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"."</span> &lt;&lt; <span class="var">sub_round</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">19</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">print_player</span>(<span class="type">std</span>::<span class="type">ifstream</span> &amp;<span class="keyword">in</span>, <span class="type">int</span> <span class="var">nr</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="keyword">in</span>.<span class="fn">seekg</span>(<span class="num">32</span> + <span class="num">67</span> * <span class="var">nr</span>, <span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">beg</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"can't move to player "</span> + <span class="fn">to_str</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">char</span> <span class="var">entry</span>[<span class="num">67</span>];<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="keyword">in</span>.<span class="fn">read</span>(<span class="var">entry</span>, <span class="fn">sizeof</span>(<span class="var">entry</span>))) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"can't read player "</span> + <span class="fn">to_str</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">char</span> *<span class="var">c</span> { <span class="var">entry</span> + <span class="num">9</span> }; *<span class="var">c</span> &amp;&amp; <span class="var">c</span> &lt; <span class="var">entry</span> + <span class="num">39</span>; ++<span class="var">c</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; *<span class="var">c</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">entry</span>[<span class="num">9</span>] &amp;&amp; <span class="var">entry</span>[<span class="num">39</span>]) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">", "</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">char</span> *<span class="var">c</span> { <span class="var">entry</span> + <span class="num">39</span> }; *<span class="var">c</span> &amp;&amp; <span class="var">c</span> &lt; <span class="var">entry</span> + <span class="num">59</span>; ++<span class="var">c</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; *<span class="var">c</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">20</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span> {<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[White \""</span>;<br/>
<span class="in1"></span><span class="fn">print_player</span>(<span class="var">player_file</span>, <span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">9</span>, <span class="num">3</span>));<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Black \""</span>;<br/>
<span class="in1"></span><span class="fn">print_player</span>(<span class="var">player_file</span>, <span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">12</span>, <span class="num">3</span>));<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
} <span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">21</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">result</span>;<br/>
<span class="in1"></span><span class="keyword">switch</span> (<span class="var">main_entry</span>[<span class="num">27</span>]) {<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">0</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"0-1"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">1</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"1/2-1/2"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="num">2</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"1-0"</span>; <span class="keyword">break</span>;<br/>
<span class="in2"></span><span class="keyword">default</span>:<br/>
<span class="in3"></span><span class="var">result</span> = <span class="str">"*"</span>; <span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[Result \""</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">result</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">22</div>
<code>
<span class="macro">@add(<span class="name">process game</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">process moves</span>)</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span> &lt;&lt; <span class="var">result</span> &lt;&lt; <span class="str">"\n\n"</span>;<br/>
<span class="macro">@end(<span class="name">process game</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">23</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="fn">get_int</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">istream</span> &amp;<span class="keyword">in</span>, <span class="type">int</span> <span class="var">len</span> = <span class="num">4</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">result</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">0</span> }; <span class="var">i</span> &lt; <span class="var">len</span>; ++<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">result</span> = (<span class="var">result</span> &lt;&lt; <span class="num">8</span>) |<br/>
<span class="in4"></span>(<span class="keyword">in</span>.<span class="fn">get</span>() &amp; <span class="num">0xff</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">24</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">memory</span>&gt;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Position</span> {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">file_</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">rank_</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">static</span> <span class="type">int</span> <span class="fn">norm</span>(<span class="type">int</span> <span class="var">v</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">v</span> &gt; <span class="num">0</span> ? <span class="num">1</span> : <span class="var">v</span> &lt; <span class="num">0</span> ? -<span class="num">1</span> : <span class="num">0</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Position</span>() {}<br/>
<span class="in2"></span><span class="var">virtual</span> ~<span class="fn">Position</span>() {}<br/>
<span class="in2"></span><span class="fn">Position</span>(<span class="type">int</span> <span class="var">file</span>, <span class="type">int</span> <span class="var">rank</span>):<br/>
<span class="in3"></span><span class="var">file_</span> { <span class="var">file</span> },<br/>
<span class="in3"></span><span class="var">rank_</span> { <span class="var">rank</span> }<br/>
<span class="in2"></span>{}<br/>
<span class="in2"></span><span class="var">operator</span> <span class="fn">bool</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">file_</span> &gt;= <span class="num">1</span> &amp;&amp; <span class="var">file_</span> &lt;= <span class="num">8</span> &amp;&amp;<br/>
<span class="in4"></span><span class="var">rank_</span> &gt;= <span class="num">1</span> &amp;&amp; <span class="var">rank_</span> &lt;= <span class="num">8</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">int</span> <span class="fn">file</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">file_</span>; }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">file</span>(<span class="type">int</span> <span class="var">file</span>) { <span class="var">file_</span> = <span class="var">file</span>; }<br/>
<span class="in2"></span><span class="type">int</span> <span class="fn">rank</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">rank_</span>; }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">rank</span>(<span class="type">int</span> <span class="var">rank</span>) { <span class="var">rank_</span> = <span class="var">rank</span>; }<br/>
<span class="in2"></span><span class="type">Position</span> &amp;<span class="var">operator</span>+=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">o</span>) {<br/>
<span class="in3"></span><span class="var">file_</span> += <span class="var">o</span>.<span class="var">file_</span>;<br/>
<span class="in3"></span><span class="var">rank_</span> += <span class="var">o</span>.<span class="var">rank_</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> *<span class="var">this</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Position</span> &amp;<span class="var">operator</span>-=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">o</span>) {<br/>
<span class="in3"></span><span class="var">file_</span> -= <span class="var">o</span>.<span class="var">file_</span>;<br/>
<span class="in3"></span><span class="var">rank_</span> -= <span class="var">o</span>.<span class="var">rank_</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> *<span class="var">this</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">file_str</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="type">char</span> <span class="var">buffer</span>[<span class="num">2</span>] = {<br/>
<span class="in4"></span>*<span class="var">this</span> ? (<span class="type">char</span>) (<span class="str">'a'</span> + <span class="var">file_</span> - <span class="num">1</span>) : <span class="str">'?'</span>,<br/>
<span class="in4"></span><span class="str">'\0'</span><br/>
<span class="in3"></span>};<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">buffer</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">rank_str</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="type">char</span> <span class="var">buffer</span>[<span class="num">2</span>] = {<br/>
<span class="in4"></span>*<span class="var">this</span> ? (<span class="type">char</span>) (<span class="str">'1'</span> + <span class="var">rank_</span> - <span class="num">1</span>) : <span class="str">'?'</span>,<br/>
<span class="in4"></span><span class="str">'\0'</span><br/>
<span class="in3"></span>};<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">buffer</span>;<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="var">operator</span> <span class="type">std</span>::<span class="fn">string</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">file_str</span>() + <span class="fn">rank_str</span>();<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="type">Position</span> <span class="fn">norm</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Position</span> { <span class="fn">norm</span>(<span class="var">file_</span>), <span class="fn">norm</span>(<span class="var">rank_</span>) };<br/>
<span class="in2"></span>}<br/>
<br/>
<span class="in2"></span><span class="type">Position</span> <span class="fn">square</span>() <span class="type">const</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Position</span> { <span class="var">file_</span> * <span class="var">file_</span>, <span class="var">rank_</span> * <span class="var">rank_</span> };<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">Position</span> <span class="var">operator</span>+(<span class="type">Position</span> <span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span> += <span class="var">b</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">operator</span>==(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span>.<span class="fn">file</span>() == <span class="var">b</span>.<span class="fn">file</span>() &amp;&amp; <span class="var">a</span>.<span class="fn">rank</span>() == <span class="var">b</span>.<span class="fn">rank</span>();<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">operator</span>!=(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> ! (<span class="var">a</span> == <span class="var">b</span>);<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Position</span> <span class="var">operator</span>-(<span class="type">Position</span> <span class="var">a</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">b</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">a</span> -= <span class="var">b</span>;<br/>
<span class="in1"></span>}<br/>
<br/>
<br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">memory</span>&gt;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Board</span>;<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Piece</span>: <span class="keyword">public</span> <span class="type">Position</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">next_</span>;<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">white_</span>;<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Position</span> { <span class="var">file</span>, <span class="var">rank</span> }, <span class="var">white_</span> { <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Position</span> { <span class="var">file</span>, <span class="var">rank</span> }, <span class="var">next_</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>) }, <span class="var">white_</span> { <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="var">virtual</span> <span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>);<br/>
<span class="in2"></span><span class="var">virtual</span> <span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> = <span class="num">0</span>;<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">pawn</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="fn">name</span>().<span class="fn">empty</span>(); }<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">white</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">white_</span>; }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">next</span>() <span class="type">const</span> { <span class="keyword">return</span> <span class="var">next_</span>.<span class="fn">get</span>(); }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">release</span>() { <span class="keyword">return</span> <span class="var">next_</span>.<span class="fn">release</span>(); }<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">reset</span>(<span class="type">Piece</span> *<span class="var">n</span>) { <span class="var">next_</span>.<span class="fn">reset</span>(<span class="var">n</span>); }<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pos</span> == *<span class="var">this</span>) { <span class="keyword">return</span> <span class="var">this</span>; };<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">next</span>() ? <span class="fn">next</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">any_attacks</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>, <span class="type">bool</span> <span class="var">verbose</span> = <span class="num">false</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (*<span class="var">this</span> &amp;&amp; <span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">verbose</span>) {<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"{attack from "</span> &lt;&lt; <span class="fn">name</span>() &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">this</span> &lt;&lt; <span class="str">" -&gt; "</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) <span class="var">p</span> &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="fn">next</span>() ? <span class="fn">next</span>()-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>) : <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_avoid_check_on</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>, <span class="type">Piece</span> *<span class="var">nw</span>);<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_avoid_check</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>);<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="type">struct</span> <span class="type">Side</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">king</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">queens</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">rooks</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">bishops</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">knights</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; <span class="var">pawns</span>;<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">clear</span>() {<br/>
<span class="in3"></span><span class="var">king</span>.<span class="fn">reset</span>();<br/>
<span class="in3"></span><span class="var">queens</span>.<span class="fn">reset</span>();<br/>
<span class="in3"></span><span class="var">rooks</span>.<span class="fn">reset</span>();<br/>
<span class="in3"></span><span class="var">bishops</span>.<span class="fn">reset</span>();<br/>
<span class="in3"></span><span class="var">knights</span>.<span class="fn">reset</span>();<br/>
<span class="in3"></span><span class="var">pawns</span>.<span class="fn">reset</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">r</span> = <span class="var">king</span>.<span class="fn">get</span>() ? <span class="var">king</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">queens</span>.<span class="fn">get</span>() ? <span class="var">queens</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">rooks</span>.<span class="fn">get</span>() ? <span class="var">rooks</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">bishops</span>.<span class="fn">get</span>() ? <span class="var">bishops</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">knights</span>.<span class="fn">get</span>() ? <span class="var">knights</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="var">r</span> = <span class="var">pawns</span>.<span class="fn">get</span>() ? <span class="var">pawns</span>.<span class="fn">get</span>()-&gt;<span class="fn">find</span>(<span class="var">pos</span>) : <span class="num">nullptr</span>;<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">r</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">any_attacks</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>, <span class="type">bool</span> <span class="var">verbose</span> = <span class="num">false</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">king</span> &amp;&amp; <span class="var">king</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">queens</span> &amp;&amp; <span class="var">queens</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">rooks</span> &amp;&amp; <span class="var">rooks</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">bishops</span> &amp;&amp; <span class="var">bishops</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">knights</span> &amp;&amp; <span class="var">knights</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>)) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">pawns</span> &amp;&amp; <span class="var">pawns</span>-&gt;<span class="fn">any_attacks</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="var">verbose</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">remove_inner</span>(<span class="type">Piece</span> *<span class="var">p</span>, <span class="type">Piece</span> *<span class="var">prev</span>) {<br/>
<span class="in3"></span><span class="keyword">while</span> (<span class="var">prev</span>) {<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">n</span> { <span class="var">prev</span>-&gt;<span class="fn">next</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">n</span>) {<br/>
<span class="in5"></span><span class="var">prev</span>-&gt;<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in5"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="var">prev</span> = <span class="var">n</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">remove</span>(<span class="type">Piece</span> *<span class="var">p</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">king</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">king</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">king</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">queens</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">queens</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">queens</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">rooks</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">rooks</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">rooks</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">bishops</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">bishops</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">bishops</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span> == <span class="var">knights</span>.<span class="fn">get</span>()) {<br/>
<span class="in4"></span><span class="var">knights</span>.<span class="fn">reset</span>(<span class="var">p</span>-&gt;<span class="fn">release</span>());<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">remove_inner</span>(<span class="var">p</span>, <span class="var">knights</span>.<span class="fn">get</span>())) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_avoid_check</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">king</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">king</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">queens</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">queens</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">rooks</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">rooks</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">bishops</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">bishops</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">knights</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">knights</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pawns</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">pawns</span>-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>)) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_piece</span>(<span class="type">Piece</span> *<span class="var">np</span>, <span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;<span class="var">lst</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="var">lst</span>) {<br/>
<span class="in4"></span><span class="var">lst</span>.<span class="fn">reset</span>(<span class="var">np</span>);<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">p</span> { <span class="var">lst</span>.<span class="fn">get</span>() };<br/>
<span class="in4"></span><span class="keyword">for</span> (; <span class="var">p</span>-&gt;<span class="fn">next</span>(); <span class="var">p</span> = <span class="var">p</span>-&gt;<span class="fn">next</span>()) {}<br/>
<span class="in4"></span><span class="var">p</span>-&gt;<span class="fn">reset</span>(<span class="var">np</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">np</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Board</span> {<br/>
<span class="in2"></span><span class="type">Side</span> <span class="var">white_</span>;<br/>
<span class="in2"></span><span class="type">Side</span> <span class="var">black_</span>;<br/>
<span class="in2"></span><span class="type">Side</span> *<span class="var">cur_</span> { &amp;<span class="var">white_</span> };<br/>
<span class="in2"></span><span class="type">Side</span> *<span class="var">other_</span> { &amp;<span class="var">black_</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">find</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">Piece</span> *<span class="var">pcs</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="fn">Board</span>(<span class="type">const</span> <span class="type">Board</span> &amp;) = <span class="keyword">delete</span>;<br/>
<span class="in2"></span><span class="type">Board</span> &amp;<span class="var">operator</span>=(<span class="type">const</span> <span class="type">Board</span> &amp;) = <span class="keyword">delete</span>;<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Board</span>();<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">king</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">queen</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">bishop</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">knight</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">rook</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">pawn</span>(<span class="type">int</span> <span class="var">nr</span> = <span class="num">1</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>) <span class="type">const</span>;<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">get</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>) { <br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="var">white_</span>.<span class="fn">find</span>(<span class="var">pos</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span>) { <span class="keyword">return</span> <span class="var">r</span>; }<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">black_</span>.<span class="fn">find</span>(<span class="var">pos</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">move</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">Piece</span> *<span class="var">first</span>, <span class="type">Piece</span> *<span class="var">from</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>);<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">switch_players</span>() { <br/>
<span class="in3"></span><span class="type">Side</span> *<span class="var">tmp</span> { <span class="var">other_</span> };<br/>
<span class="in3"></span><span class="var">other_</span> = <span class="var">cur_</span>;<br/>
<span class="in3"></span><span class="var">cur_</span> = <span class="var">tmp</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">white</span>() <span class="type">const</span> { <span class="keyword">return</span> &amp;<span class="var">white_</span> == <span class="var">cur_</span>; }<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">mate</span>() { <br/>
<span class="in3"></span><span class="fn">switch_players</span>();<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">result</span> { ! <span class="var">cur_</span>-&gt;<span class="fn">can_avoid_check</span>(*<span class="var">this</span>) };<br/>
<span class="in3"></span><span class="fn">switch_players</span>();<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">result</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">check</span>(<span class="type">bool</span> <span class="var">other</span> = <span class="num">true</span>, <span class="type">bool</span> <span class="var">verbose</span> = <span class="num">false</span>) { <br/>
<span class="in3"></span><span class="type">Side</span> *<span class="var">s</span> { <span class="var">other</span> ? <span class="var">other_</span> : <span class="var">cur_</span> };<br/>
<span class="in3"></span><span class="type">Side</span> *<span class="var">o</span> { <span class="var">other</span> ? <span class="var">cur_</span> : <span class="var">other_</span> };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">s</span>-&gt;<span class="var">king</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">o</span>-&gt;<span class="fn">any_attacks</span>(*<span class="var">this</span>, *<span class="var">s</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>(), <span class="var">verbose</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">kingside_rochade</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>);<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">queenside_rochade</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>);<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">remove</span>(<span class="type">Piece</span> *<span class="var">piece</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">piece</span>-&gt;<span class="fn">pawn</span>()) {<br/>
<span class="in4"></span><span class="var">piece</span>-&gt;<span class="fn">file</span>(<span class="num">0</span>);<br/>
<span class="in4"></span><span class="var">piece</span>-&gt;<span class="fn">rank</span>(<span class="num">0</span>);<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">name</span> { <span class="var">piece</span>-&gt;<span class="fn">name</span>() + (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">piece</span> };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">white_</span>.<span class="fn">remove</span>(<span class="var">piece</span>)) { <span class="keyword">return</span>; };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">black_</span>.<span class="fn">remove</span>(<span class="var">piece</span>)) { <span class="keyword">return</span>; }<br/>
<span class="in4"></span><span class="fn">fail</span>(<span class="str">"can't remove piece "</span> + <span class="var">name</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_king</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_queen</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_rook</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_bishop</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_knight</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">add_pawn</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span> = <span class="num">false</span>);<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="fn">first</span>(<span class="type">const</span> <span class="type">Piece</span> &amp;<span class="var">p</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">""</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">pawns</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">"K"</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">"Q"</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">queens</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">"R"</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">"B"</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">bishops</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">p</span>.<span class="fn">name</span>() == <span class="str">"N"</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="var">knights</span>.<span class="fn">get</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="fn">fail</span>(<span class="str">"uknown name "</span> + <span class="var">p</span>.<span class="fn">name</span>());<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">nullptr</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">void</span> <span class="fn">clear</span>() {<br/>
<span class="in3"></span><span class="var">white_</span>.<span class="fn">clear</span>();<br/>
<span class="in3"></span><span class="var">black_</span>.<span class="fn">clear</span>();<br/>
<span class="in3"></span><span class="var">cur_</span> = &amp;<span class="var">white_</span>;<br/>
<span class="in3"></span><span class="var">other_</span> = &amp;<span class="var">black_</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>} <span class="var">brd</span>;<br/>
<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">find</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">Piece</span> *<span class="var">pcs</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">for</span> (; <span class="var">nr</span> &gt; <span class="num">1</span> &amp;&amp; <span class="var">pcs</span>; --<span class="var">nr</span>) {<br/>
<span class="in3"></span><span class="var">pcs</span> = <span class="var">pcs</span>-&gt;<span class="fn">next</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">pcs</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">king</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">king</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">queen</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">queens</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">queens</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">bishop</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">bishops</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">bishops</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">knight</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">knights</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">knights</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">rook</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">pawn</span>(<span class="type">int</span> <span class="var">nr</span>, <span class="type">bool</span> <span class="var">other</span>) <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">find</span>(<span class="var">nr</span>, <span class="var">other</span> ? <span class="var">other_</span>-&gt;<span class="var">pawns</span>.<span class="fn">get</span>() : <span class="var">cur_</span>-&gt;<span class="var">pawns</span>.<span class="fn">get</span>());<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">bool</span> <span class="type">Piece</span>::<span class="fn">can_avoid_check_on</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>, <span class="type">Piece</span> *<span class="var">nw</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="fn">pawn</span>() &amp;&amp; ! <span class="var">nw</span> &amp;&amp; (<span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">1</span> || <span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">8</span>)) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">can_avoid_check_on</span>(<span class="var">brd</span>, <span class="var">to</span>, <span class="var">brd</span>.<span class="fn">add_queen</span>(<span class="var">to</span>))) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">can_avoid_check_on</span>(<span class="var">brd</span>, <span class="var">to</span>, <span class="var">brd</span>.<span class="fn">add_knight</span>(<span class="var">to</span>))) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">can_avoid_check_on</span>(<span class="var">brd</span>, <span class="var">to</span>, <span class="var">brd</span>.<span class="fn">add_rook</span>(<span class="var">to</span>))) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">can_avoid_check_on</span>(<span class="var">brd</span>, <span class="var">to</span>, <span class="var">brd</span>.<span class="fn">add_bishop</span>(<span class="var">to</span>))) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">from</span> { <span class="fn">file</span>(), <span class="fn">rank</span>() };<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">old</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">old</span>) { <span class="var">old</span>-&gt;<span class="fn">file</span>(-<span class="var">old</span>-&gt;<span class="fn">file</span>()); }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">nw</span>) {<br/>
<span class="in4"></span><span class="fn">file</span>(-<span class="fn">file</span>());<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="fn">file</span>(<span class="var">to</span>.<span class="fn">file</span>());<br/>
<span class="in4"></span><span class="fn">rank</span>(<span class="var">to</span>.<span class="fn">rank</span>());<br/>
<span class="in3"></span>}<br/>
<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">can_avoid</span> { ! <span class="var">brd</span>.<span class="fn">check</span>(<span class="num">false</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">name</span>() == <span class="str">"Kxx"</span>) {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"{"</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">this</span> &lt;&lt; <span class="str">": "</span><br/>
<span class="in5"></span>&lt;&lt; (<span class="var">can_avoid</span> ? <span class="str">"1"</span> : <span class="str">"0"</span>) &lt;&lt; (<span class="var">nw</span> ? <span class="str">"n"</span> : <span class="str">""</span>) &lt;&lt; <span class="str">"}"</span>;<br/>
<span class="in3"></span>}<br/>
<br/>
<span class="in3"></span><span class="fn">file</span>(<span class="var">from</span>.<span class="fn">file</span>());<br/>
<span class="in3"></span><span class="fn">rank</span>(<span class="var">from</span>.<span class="fn">rank</span>());<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">old</span>) { <span class="var">old</span>-&gt;<span class="fn">file</span>(-<span class="var">old</span>-&gt;<span class="fn">file</span>()); }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">nw</span>) { <span class="var">brd</span>.<span class="fn">remove</span>(<span class="var">nw</span>); };<br/>
<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">can_avoid</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="type">Piece</span>::<span class="fn">can_avoid_check</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>) {<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">p</span>;<br/>
<span class="in2"></span><span class="keyword">if</span> (*<span class="var">this</span>) {<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">r</span> { <span class="num">1</span> }; <span class="var">r</span> &lt;= <span class="num">8</span>; ++<span class="var">r</span>) {<br/>
<span class="in4"></span><span class="var">p</span>.<span class="fn">rank</span>(<span class="var">r</span>);<br/>
<span class="in4"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">f</span> { <span class="num">1</span> }; <span class="var">f</span> &lt;= <span class="num">8</span>; ++<span class="var">f</span>) {<br/>
<span class="in5"></span><span class="var">p</span>.<span class="fn">file</span>(<span class="var">f</span>);<br/>
<span class="in5"></span><span class="keyword">if</span> (! <span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">p</span>)) {<br/>
<span class="in6"></span><span class="keyword">continue</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="fn">can_avoid_check_on</span>(<span class="var">brd</span>, <span class="var">p</span>, <span class="num">nullptr</span>)) {<br/>
<span class="in6"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="fn">next</span>() ? <span class="fn">next</span>()-&gt;<span class="fn">can_avoid_check</span>(<span class="var">brd</span>) : <span class="num">false</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">move</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">Piece</span> *<span class="var">first</span>, <span class="type">Piece</span> *<span class="var">from</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">from</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no piece to move from"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">captures</span> { <span class="var">to_piece</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">from</span>-&gt;<span class="fn">pawn</span>() &amp;&amp; <span class="var">from</span>-&gt;<span class="fn">file</span>() != <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="var">captures</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">white</span>()) {<br/>
<span class="in5"></span><span class="var">to_piece</span> = <span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span> { <span class="num">0</span>, -<span class="num">1</span> });<br/>
<span class="in4"></span>} <span class="keyword">else</span> {<br/>
<span class="in5"></span><span class="var">to_piece</span> = <span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span> { <span class="num">0</span>, <span class="num">1</span> });<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="var">captures</span> = <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">name</span>();// &lt;&lt; <span class="str">'('</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">from</span> &lt;&lt; <span class="str">')'</span>;<br/>
<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">from</span>-&gt;<span class="fn">pawn</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">captures</span>) {<br/>
<span class="in4"></span><span class="var">out</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">file_str</span>();<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">same_f</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">same_r</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="type">bool</span> <span class="var">multiple</span> { <span class="num">false</span> };<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">cur</span> { <span class="var">first</span> }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span> == <span class="var">from</span>) { <span class="keyword">continue</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">cur</span>-&gt;<span class="fn">can_move_to</span>(*<span class="var">this</span>, <span class="var">to</span>)) { <span class="keyword">continue</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">file</span>() == <span class="var">from</span>-&gt;<span class="fn">file</span>()) { <span class="var">same_f</span> = <span class="num">true</span>; }<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">rank</span>() == <span class="var">from</span>-&gt;<span class="fn">rank</span>()) { <span class="var">same_r</span> = <span class="num">true</span>; }<br/>
<span class="in4"></span><span class="var">multiple</span> = <span class="num">true</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">multiple</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">same_f</span> || (<span class="var">same_f</span> &amp;&amp; <span class="var">same_r</span>)) {<br/>
<span class="in5"></span><span class="var">out</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">file_str</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">same_f</span>) {<br/>
<span class="in5"></span><span class="var">out</span> &lt;&lt; <span class="var">from</span>-&gt;<span class="fn">rank_str</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">captures</span>) { <span class="var">out</span> &lt;&lt; <span class="str">"x"</span>; }<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) {<br/>
<span class="in3"></span><span class="fn">remove</span>(<span class="var">to_piece</span>);<br/>
<span class="in3"></span><span class="var">to_piece</span> = <span class="num">nullptr</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">from</span>-&gt;<span class="fn">file</span>(<span class="var">to</span>.<span class="fn">file</span>());<br/>
<span class="in2"></span><span class="var">from</span>-&gt;<span class="fn">rank</span>(<span class="var">to</span>.<span class="fn">rank</span>());<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) <span class="var">to</span>;<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="fn">check</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">mate</span>()) {<br/>
<span class="in4"></span><span class="var">out</span> &lt;&lt; <span class="str">'#'</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="var">out</span> &lt;&lt; <span class="str">'+'</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">bool</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to_piece</span> &amp;&amp; <span class="var">to_piece</span>-&gt;<span class="fn">white</span>() == <span class="var">white_</span>) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in2"></span><br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">d</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">norm</span>() };<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">cur</span> { *<span class="var">this</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (;;) {<br/>
<span class="in3"></span><span class="var">cur</span> = <span class="var">cur</span> + <span class="var">d</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="var">cur</span>) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">cur</span> == <span class="var">to</span>) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">brd</span>.<span class="fn">get</span>(<span class="var">cur</span>)) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Rook_Piece</span>: <span class="keyword">public</span> <span class="var">virtual</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Rook_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Rook_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">file</span>() == <span class="fn">file</span>() || <span class="var">to</span>.<span class="fn">rank</span>() == <span class="fn">rank</span>()) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"R"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Bishop_Piece</span>: <span class="keyword">public</span> <span class="var">virtual</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Bishop_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Bishop_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">d</span> { <span class="var">to</span> - *<span class="var">this</span> };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">d</span>.<span class="fn">file</span>() == <span class="var">d</span>.<span class="fn">rank</span>() || <span class="var">d</span>.<span class="fn">file</span>() == -<span class="var">d</span>.<span class="fn">rank</span>()) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"B"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Queen_Piece</span>: <span class="keyword">public</span> <span class="type">Rook_Piece</span>, <span class="keyword">public</span> <span class="type">Bishop_Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Queen_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Queen_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="type">Rook_Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>) ||<br/>
<span class="in4"></span><span class="type">Bishop_Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"Q"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">King_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">King_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">King_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() &lt;= <span class="num">1</span> &amp;&amp; <span class="var">sq</span>.<span class="fn">rank</span>() &lt;= <span class="num">1</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="type">Piece</span>::<span class="fn">can_move_to</span>(<span class="var">brd</span>, <span class="var">to</span>);<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"K"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Knight_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Knight_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="fn">Knight_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>, <span class="type">bool</span> <span class="var">white</span> = <span class="num">true</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="var">white</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() + <span class="var">sq</span>.<span class="fn">rank</span>() == <span class="num">5</span> &amp;&amp; (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span> || <span class="var">sq</span>.<span class="fn">rank</span>() == <span class="num">1</span>)) {<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">to_piece</span> &amp;&amp; <span class="var">to_piece</span>-&gt;<span class="fn">white</span>() == <span class="fn">white</span>()) { <span class="keyword">return</span> <span class="num">false</span>; }<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in4"></span><br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>};<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">"N"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">White_Pawn_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">White_Pawn_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="num">true</span> } {}<br/>
<span class="in2"></span><span class="fn">White_Pawn_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="num">true</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">2</span> &amp;&amp; <span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">4</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>() &amp;&amp; ! <span class="var">to_piece</span> &amp;&amp; ! <span class="var">brd</span>.<span class="fn">get</span>(*<span class="var">this</span> + <span class="type">Position</span> { <span class="num">0</span>, <span class="num">1</span>});<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">rank</span>() + <span class="num">1</span> == <span class="var">to</span>.<span class="fn">rank</span>()) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in5"></span><span class="keyword">return</span> ! <span class="var">to_piece</span>;<br/>
<span class="in4"></span>};<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) { <span class="keyword">return</span> ! <span class="var">to_piece</span>-&gt;<span class="fn">white</span>(); }<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">5</span>) {<br/>
<span class="in6"></span><span class="type">Piece</span> *<span class="var">p</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span>{<span class="num">0</span>, -<span class="num">1</span>}) };<br/>
<span class="in6"></span><span class="keyword">return</span> <span class="var">p</span> &amp;&amp; ! <span class="var">p</span>-&gt;<span class="fn">white</span>() &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">pawn</span>();<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">""</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Black_Pawn_Piece</span>: <span class="keyword">public</span> <span class="type">Piece</span> {<br/>
<span class="in1"></span><span class="keyword">public</span>:<br/>
<span class="in2"></span><span class="fn">Black_Pawn_Piece</span>(<span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="var">file</span>, <span class="var">rank</span>, <span class="num">false</span> } {}<br/>
<span class="in2"></span><span class="fn">Black_Pawn_Piece</span>(<span class="type">std</span>::<span class="var">unique_ptr</span>&lt;<span class="type">Piece</span>&gt; &amp;&amp;<span class="var">next</span>, <span class="type">int</span> <span class="var">file</span> = <span class="num">0</span>, <span class="type">int</span> <span class="var">rank</span> = <span class="num">0</span>): <span class="type">Piece</span> { <span class="type">std</span>::<span class="fn">move</span>(<span class="var">next</span>), <span class="var">file</span>, <span class="var">rank</span>, <span class="num">false</span> } {}<br/>
<span class="in2"></span><span class="type">bool</span> <span class="fn">can_move_to</span>(<span class="type">Board</span> &amp;<span class="var">brd</span>, <span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">to</span>) <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span>) };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">7</span> &amp;&amp; <span class="var">to</span>.<span class="fn">rank</span>() == <span class="num">5</span>) {<br/>
<span class="in4"></span><span class="keyword">return</span> <span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>() &amp;&amp; ! <span class="var">to_piece</span> &amp;&amp; ! <span class="var">brd</span>.<span class="fn">get</span>(*<span class="var">this</span> + <span class="type">Position</span> { <span class="num">0</span>, -<span class="num">1</span> });<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">rank</span>() - <span class="num">1</span> == <span class="var">to</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="fn">file</span>() == <span class="var">to</span>.<span class="fn">file</span>()) {<br/>
<span class="in5"></span><span class="keyword">return</span> ! <span class="var">to_piece</span>;<br/>
<span class="in4"></span>};<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">sq</span> { (<span class="var">to</span> - *<span class="var">this</span>).<span class="fn">square</span>() };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">sq</span>.<span class="fn">file</span>() == <span class="num">1</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">to_piece</span>) { <span class="keyword">return</span> <span class="var">to_piece</span>-&gt;<span class="fn">white</span>(); }<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="fn">rank</span>() == <span class="num">4</span>) {<br/>
<span class="in6"></span><span class="type">Piece</span> *<span class="var">p</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">to</span> + <span class="type">Position</span>{<span class="num">0</span>, <span class="num">1</span>}) };<br/>
<span class="in6"></span><span class="keyword">return</span> <span class="var">p</span> &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">white</span>() &amp;&amp; <span class="var">p</span>-&gt;<span class="fn">pawn</span>();<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="fn">name</span>() <span class="type">const</span> <span class="keyword">override</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="str">""</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_king</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">King_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), ! <span class="fn">white</span>()), <span class="var">other_</span>-&gt;<span class="var">king</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">King_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), <span class="fn">white</span>()), <span class="var">cur_</span>-&gt;<span class="var">king</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_queen</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Queen_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), ! <span class="fn">white</span>()), <span class="var">other_</span>-&gt;<span class="var">queens</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Queen_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), <span class="fn">white</span>()), <span class="var">cur_</span>-&gt;<span class="var">queens</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_rook</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Rook_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), ! <span class="fn">white</span>()), <span class="var">other_</span>-&gt;<span class="var">rooks</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Rook_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), <span class="fn">white</span>()), <span class="var">cur_</span>-&gt;<span class="var">rooks</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_bishop</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Bishop_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), ! <span class="fn">white</span>()), <span class="var">other_</span>-&gt;<span class="var">bishops</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Bishop_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), <span class="fn">white</span>()), <span class="var">cur_</span>-&gt;<span class="var">bishops</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_knight</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Knight_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), ! <span class="fn">white</span>()), <span class="var">other_</span>-&gt;<span class="var">knights</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="keyword">new</span> <span class="fn">Knight_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>(), <span class="fn">white</span>()), <span class="var">cur_</span>-&gt;<span class="var">knights</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">Piece</span> *<span class="type">Board</span>::<span class="fn">add_pawn</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">pos</span>, <span class="type">bool</span> <span class="var">other</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">other</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">other_</span>-&gt;<span class="fn">add_piece</span>(<span class="fn">white</span>() ? (<span class="type">Piece</span> *) <span class="keyword">new</span> <span class="fn">Black_Pawn_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>()): (<span class="type">Piece</span> *) <span class="keyword">new</span> <span class="fn">White_Pawn_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>()), <span class="var">other_</span>-&gt;<span class="var">pawns</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="var">cur_</span>-&gt;<span class="fn">add_piece</span>(<span class="fn">white</span>() ? (<span class="type">Piece</span> *) <span class="keyword">new</span> <span class="fn">White_Pawn_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>()): (<span class="type">Piece</span> *) <span class="keyword">new</span> <span class="fn">Black_Pawn_Piece</span>(<span class="var">pos</span>.<span class="fn">file</span>(), <span class="var">pos</span>.<span class="fn">rank</span>()), <span class="var">cur_</span>-&gt;<span class="var">pawns</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">Board</span>::<span class="fn">Board</span>() {<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">king</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">King_Piece</span>&gt;(<span class="num">5</span>, <span class="num">1</span>, <span class="num">true</span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">king</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">King_Piece</span>&gt;(<span class="num">5</span>, <span class="num">8</span>, <span class="num">false</span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">queens</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Queen_Piece</span>&gt;(<span class="num">4</span>, <span class="num">1</span>, <span class="num">true</span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">queens</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Queen_Piece</span>&gt;(<span class="num">4</span>, <span class="num">8</span>, <span class="num">false</span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">rooks</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<span class="num">8</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">1</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">rooks</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Rook_Piece</span>&gt;(<span class="num">8</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">1</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">bishops</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<span class="num">6</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">3</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">bishops</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Bishop_Piece</span>&gt;(<span class="num">6</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">3</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">white_</span>.<span class="var">knights</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<span class="num">7</span>, <span class="num">1</span>, <span class="num">true</span>), <span class="num">2</span>, <span class="num">1</span>, <span class="num">true</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">black_</span>.<span class="var">knights</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Knight_Piece</span>&gt;(<span class="num">7</span>, <span class="num">8</span>, <span class="num">false</span>), <span class="num">2</span>, <span class="num">8</span>, <span class="num">false</span><br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">i</span> { <span class="num">8</span> }; <span class="var">i</span> &gt; <span class="num">0</span>; --<span class="var">i</span>) {<br/>
<span class="in3"></span><span class="var">white_</span>.<span class="var">pawns</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">White_Pawn_Piece</span>&gt;(<br/>
<span class="in4"></span><span class="type">std</span>::<span class="fn">move</span>(<span class="var">white_</span>.<span class="var">pawns</span>), <span class="var">i</span>, <span class="num">2</span><br/>
<span class="in3"></span>);<br/>
<span class="in3"></span><span class="var">black_</span>.<span class="var">pawns</span> = <span class="type">std</span>::<span class="var">make_unique</span>&lt;<span class="type">Black_Pawn_Piece</span>&gt;(<br/>
<span class="in4"></span><span class="type">std</span>::<span class="fn">move</span>(<span class="var">black_</span>.<span class="var">pawns</span>), <span class="var">i</span>, <span class="num">7</span><br/>
<span class="in3"></span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">25</div>
<code>
<span class="macro">@def(<span class="name">unit-tests</span>)</span> <br/>
<span class="in1"></span><span class="type">Board</span> <span class="var">brd</span>;<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">26</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_1_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">nr</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">pc</span> { (<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="var">nr</span>, <span class="var">other</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">pc</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no figure at index "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">pcs</span> { (<span class="type">std</span>::<span class="type">string</span>) *<span class="var">pc</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">pcs</span> != <span class="var">exp</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"got "</span> + <span class="var">pcs</span> + <span class="str">" but expecting "</span> + <span class="var">exp</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_1_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">2</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than one piece"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">27</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">false</span>, <span class="str">"e1"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">true</span>, <span class="str">"e8"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="num">false</span>, <span class="str">"d1"</span>);<br/>
<span class="in1"></span><span class="fn">test_1_fig</span>(&amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="num">true</span>, <span class="str">"d8"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">28</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_2_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_1</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_2</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp_1</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">2</span>, <span class="var">other</span>, <span class="var">exp_2</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">3</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than two pieces"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span>;<br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">29</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="num">false</span>, <span class="str">"a1"</span>, <span class="str">"h1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="num">true</span>, <span class="str">"a8"</span>, <span class="str">"h8"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="num">false</span>, <span class="str">"b1"</span>, <span class="str">"g1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="num">true</span>, <span class="str">"b8"</span>, <span class="str">"g8"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="num">false</span>, <span class="str">"c1"</span>, <span class="str">"f1"</span>);<br/>
<span class="in1"></span><span class="fn">test_2_fig</span>(&amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="num">true</span>, <span class="str">"c8"</span>, <span class="str">"f8"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">30</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_8_fig</span>(<br/>
<span class="in2"></span><span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>,<br/>
<span class="in2"></span><span class="type">bool</span> <span class="var">other</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_1</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_2</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_3</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_4</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_5</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_6</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_7</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp_8</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">1</span>, <span class="var">other</span>, <span class="var">exp_1</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">2</span>, <span class="var">other</span>, <span class="var">exp_2</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">3</span>, <span class="var">other</span>, <span class="var">exp_3</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">4</span>, <span class="var">other</span>, <span class="var">exp_4</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">5</span>, <span class="var">other</span>, <span class="var">exp_5</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">6</span>, <span class="var">other</span>, <span class="var">exp_6</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">7</span>, <span class="var">other</span>, <span class="var">exp_7</span>);<br/>
<span class="in2"></span><span class="fn">test_1_fig</span>(<span class="var">fn</span>, <span class="num">8</span>, <span class="var">other</span>, <span class="var">exp_8</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> ((<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">9</span>, <span class="var">other</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"more than 8 pieces"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">31</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span><br/>
<span class="in1"></span><span class="fn">test_8_fig</span>(&amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="num">false</span>, <span class="str">"a2"</span>, <span class="str">"b2"</span>, <span class="str">"c2"</span>, <span class="str">"d2"</span>, <span class="str">"e2"</span>, <span class="str">"f2"</span>, <span class="str">"g2"</span>, <span class="str">"h2"</span>);<br/>
<span class="in1"></span><span class="fn">test_8_fig</span>(&amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="num">true</span>, <span class="str">"a7"</span>, <span class="str">"b7"</span>, <span class="str">"c7"</span>, <span class="str">"d7"</span>, <span class="str">"e7"</span>, <span class="str">"f7"</span>, <span class="str">"g7"</span>, <span class="str">"h7"</span>);<br/>
<span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
</div>
<p>	 <code></code><code> <span class="macro">@add(<span class="name">unit-tests</span>)</span> 	<span class="keyword">for</span> (<span class="type">int</span> <span class="var">f</span> { <span class="num">1</span> }; <span class="var">f</span> &lt;= <span class="num">8</span>; ++<span class="var">f</span>) { 		<span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">1</span> }) || ! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">1</span> })-&gt;<span class="fn">white</span>()) { 			<span class="fn">fail</span>(<span class="str">"not white on "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { <span class="var">f</span>, <span class="num">1</span> }); 		} 		<span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">2</span> }) || ! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">2</span> })-&gt;<span class="fn">white</span>()) { 			<span class="fn">fail</span>(<span class="str">"not white on "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { <span class="var">f</span>, <span class="num">2</span> }); 		} 		<span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">7</span> }) || <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">7</span> })-&gt;<span class="fn">white</span>()) { 			<span class="fn">fail</span>(<span class="str">"no black on "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { <span class="var">f</span>, <span class="num">7</span> }); 		} 		<span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">8</span> }) || <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="num">8</span> })-&gt;<span class="fn">white</span>()) { 			<span class="fn">fail</span>(<span class="str">"no black on "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { <span class="var">f</span>, <span class="num">8</span> }); 		} 		<span class="keyword">for</span> (<span class="type">int</span> <span class="var">r</span> { <span class="num">3</span> }; <span class="var">r</span> &lt;= <span class="num">6</span>; ++<span class="var">r</span>) { 			<span class="keyword">if</span> (<span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> })) { 				<span class="fn">fail</span>(<span class="str">"not empty on "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> }); 			} 		} 	} <span class="macro">@end(<span class="name">unit-tests</span>)</span> </code><code></code>
</p>
<div class="slides">
<div class="page"><div class="slide"><div class="slide-nr">32</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">test_add</span>(<span class="type">const</span> <span class="type">Position</span> &amp;<span class="var">p</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>, <span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">exp</span>) {<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">q</span> { <span class="var">p</span> + <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> } };<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">got</span> { (<span class="type">std</span>::<span class="type">string</span>) <span class="var">q</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">got</span> != <span class="var">exp</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"adding returns "</span> + <span class="var">got</span> + <span class="str">" instead of "</span> + <span class="var">exp</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">33</div>
<code>
<span class="macro">@add(<span class="name">unit-tests</span>)</span> {<br/>
<span class="in1"></span><span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">wk</span> { *<span class="var">brd</span>.<span class="fn">king</span>() };<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, <span class="num">0</span>, <span class="num">0</span>, <span class="str">"e1"</span>);<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, -<span class="num">4</span>, <span class="num">0</span>, <span class="str">"a1"</span>);<br/>
<span class="in1"></span><span class="fn">test_add</span>(<span class="var">wk</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="str">"h1"</span>);<br/>
} <span class="macro">@end(<span class="name">unit-tests</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">34</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">move_piece</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">Piece</span> *(<span class="type">Board</span>::*<span class="var">fn</span>)(<span class="type">int</span>, <span class="type">bool</span>) <span class="type">const</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">from</span> { (<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="var">nr</span>, <span class="num">false</span>) };<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">from</span>) { <span class="fn">fail</span>(<span class="str">"no piece to move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>)); }<br/>
<span class="in2"></span><span class="type">Position</span> <span class="var">to</span> { *<span class="var">from</span> + <span class="type">Position</span> { <span class="var">f</span>, <span class="var">r</span> } };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">file</span>() &gt; <span class="num">8</span>) { <span class="var">to</span> -= <span class="type">Position</span> { <span class="num">8</span>, <span class="num">0</span> }; }<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">to</span>.<span class="fn">rank</span>() &gt; <span class="num">8</span>) { <span class="var">to</span> -= <span class="type">Position</span> { <span class="num">0</span>, <span class="num">8</span> }; }<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">to</span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">brd</span>.<span class="fn">move</span>(<span class="var">out</span>, (<span class="var">brd</span>.*<span class="var">fn</span>)(<span class="num">1</span>, <span class="num">false</span>), <span class="var">from</span>, <span class="var">to</span>);<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">35</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_king</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">king</span>, <span class="num">1</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid king move"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">36</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_queen</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">queen</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid queen move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">37</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_rook</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">rook</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid rook move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">38</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_bishop</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">bishop</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid bishop move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">39</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_knight</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">knight</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid knight move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">40</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">move_pawn</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>, <span class="type">int</span> <span class="var">nr</span>, <span class="type">int</span> <span class="var">f</span>, <span class="type">int</span> <span class="var">r</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">brd</span>.<span class="fn">white</span>()) {<br/>
<span class="in3"></span><span class="var">r</span> = <span class="num">8</span> - <span class="var">r</span>;<br/>
<span class="in3"></span><span class="var">f</span> = <span class="var">f</span> ? <span class="num">8</span> - <span class="var">f</span> : <span class="num">0</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="fn">move_piece</span>(<span class="var">out</span>, &amp;<span class="type">Board</span>::<span class="var">pawn</span>, <span class="var">nr</span>, <span class="var">f</span>, <span class="var">r</span>)) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"invalid pawn move "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">nr</span>) + <span class="str">", "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">f</span>) + <span class="str">", "</span> + <span class="type">std</span>::<span class="fn">to_string</span>(<span class="var">r</span>));<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">41</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">kingside_rochade</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">kp</span> { <span class="fn">king</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">kf</span> { <span class="var">kp</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">mf</span> { <span class="num">9</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="num">nullptr</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">Piece</span> *<span class="var">cur</span> { <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">rank</span>() != <span class="var">kp</span>-&gt;<span class="fn">rank</span>()) { <span class="keyword">continue</span>; }<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">pf</span> { <span class="var">cur</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pf</span> &gt; <span class="var">kf</span> &amp;&amp; <span class="var">pf</span> &lt; <span class="var">mf</span>) {<br/>
<span class="in4"></span><span class="var">mf</span> = <span class="var">pf</span>;<br/>
<span class="in4"></span><span class="var">r</span> = <span class="var">cur</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">r</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no kingside rook found"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">r</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> + <span class="num">1</span>);<br/>
<span class="in2"></span><span class="var">kp</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> + <span class="num">2</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"O-O"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">42</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Board</span>::<span class="fn">queenside_rochade</span>(<span class="type">std</span>::<span class="type">ostream</span> &amp;<span class="var">out</span>) {<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">kp</span> { <span class="fn">king</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">kf</span> { <span class="var">kp</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">mf</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">Piece</span> *<span class="var">r</span> { <span class="num">nullptr</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">Piece</span> *<span class="var">cur</span> { <span class="var">cur_</span>-&gt;<span class="var">rooks</span>.<span class="fn">get</span>() }; <span class="var">cur</span>; <span class="var">cur</span> = <span class="var">cur</span>-&gt;<span class="fn">next</span>()) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">cur</span>-&gt;<span class="fn">rank</span>() != <span class="var">kp</span>-&gt;<span class="fn">rank</span>()) { <span class="keyword">continue</span>; }<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">pf</span> { <span class="var">cur</span>-&gt;<span class="fn">file</span>() };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">pf</span> &lt; <span class="var">kf</span> &amp;&amp; <span class="var">pf</span> &gt; <span class="var">mf</span>) {<br/>
<span class="in4"></span><span class="var">mf</span> = <span class="var">pf</span>;<br/>
<span class="in4"></span><span class="var">r</span> = <span class="var">cur</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">r</span>) {<br/>
<span class="in3"></span><span class="fn">fail</span>(<span class="str">"no queenside rook found"</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">r</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> - <span class="num">1</span>);<br/>
<span class="in2"></span><span class="var">kp</span>-&gt;<span class="fn">file</span>(<span class="var">kf</span> - <span class="num">2</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"O-O-O"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">43</div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">sstream</span>&gt;<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div class="page"><div class="slide"><div class="slide-nr">44</div>
<code>
<span class="macro">@def(<span class="name">process moves</span>)</span> {<br/>
<span class="in1"></span><span class="var">brd</span>.~<span class="fn">Board</span>();<br/>
<span class="in1"></span><span class="keyword">new</span> (&amp;<span class="var">brd</span>) <span class="fn">Board</span>();<br/>
<span class="in1"></span><span class="keyword">if</span> (! <span class="var">game_file</span>.<span class="fn">seekg</span>(<span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">1</span>), <span class="type">std</span>::<span class="type">ifstream</span>::<span class="var">beg</span>)) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"can't move to game at "</span> + <span class="fn">to_str</span>(<span class="fn">get_int</span>(<span class="var">main_entry</span> + <span class="num">1</span>)));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">len</span> { <span class="fn">get_int</span>(<span class="var">game_file</span>) };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">len</span> &amp; <span class="num">0x80000000</span>) {<br/>
<span class="in2"></span><span class="fn">fail</span>(<span class="str">"unknown game data of length "</span> + <span class="fn">to_str</span>(<span class="var">len</span>));<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="type">bool</span> <span class="var">start_with_white</span> { <span class="num">true</span> };<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">len</span> &amp; <span class="num">0x40000000</span>) {<br/>
<span class="in2"></span><span class="var">len</span> &amp;= <span class="num">0x3fffffff</span>;<br/>
<span class="in2"></span><span class="type">char</span> <span class="var">bd</span>[<span class="num">65</span>] { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="var">brd</span>.<span class="fn">clear</span>();<br/>
<span class="in2"></span><span class="var">game_file</span>.<span class="fn">get</span>();<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">game_file</span>.<span class="fn">get</span>() &amp; <span class="num">0x8</span>) {<br/>
<span class="in3"></span><span class="var">start_with_white</span> = <span class="num">false</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">game_file</span>.<span class="fn">get</span>();<br/>
<span class="in2"></span>/* <span class="type">int</span> <span class="var">move_nr</span> = */ <span class="var">game_file</span>.<span class="fn">get</span>();<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">value</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">bits</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">cnt</span> { <span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">f</span> { <span class="num">1</span> }; <span class="var">f</span> &lt;= <span class="num">8</span>; ++<span class="var">f</span>) {<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">r</span> { <span class="num">1</span> }; <span class="var">r</span> &lt;= <span class="num">8</span>; ++<span class="var">r</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">bits</span> &lt; <span class="num">1</span>) {<br/>
<span class="in5"></span><span class="var">value</span> = (<span class="var">value</span> &lt;&lt; <span class="num">8</span>) | <span class="var">game_file</span>.<span class="fn">get</span>();<br/>
<span class="in5"></span>++<span class="var">cnt</span>;<br/>
<span class="in5"></span><span class="var">bits</span> += <span class="num">8</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (! ((<span class="var">value</span> &gt;&gt; (<span class="var">bits</span> - <span class="num">1</span>) &amp; <span class="num">0x1</span>))) {<br/>
<span class="in5"></span>--<span class="var">bits</span>;<br/>
<span class="in5"></span><span class="keyword">continue</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">bits</span> &lt; <span class="num">5</span>) {<br/>
<span class="in5"></span><span class="var">value</span> = (<span class="var">value</span> &lt;&lt; <span class="num">8</span>) | <span class="var">game_file</span>.<span class="fn">get</span>();<br/>
<span class="in5"></span><span class="var">bits</span> += <span class="num">8</span>;<br/>
<span class="in5"></span>++<span class="var">cnt</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">piece</span> { (<span class="var">value</span> &gt;&gt; (<span class="var">bits</span> - <span class="num">5</span>)) &amp; <span class="num">0x1f</span> };<br/>
<span class="in4"></span><span class="var">value</span> = <span class="var">value</span> - (<span class="var">piece</span> &lt;&lt; (<span class="var">bits</span> - <span class="num">5</span>));<br/>
<span class="in4"></span><span class="var">bits</span> -= <span class="num">5</span>;<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">idx</span> { (<span class="var">r</span> - <span class="num">1</span>) * <span class="num">8</span> + (<span class="var">f</span> - <span class="num">1</span>) };<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">p</span> { <span class="var">f</span>, <span class="var">r</span> };<br/>
<span class="in4"></span><span class="keyword">switch</span> (<span class="var">piece</span>) {<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x11</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'K'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_king</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x12</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'Q'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_queen</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x13</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'N'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_knight</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x14</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'B'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_bishop</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x15</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'R'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_rook</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x16</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'P'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_pawn</span>(<span class="var">p</span>, <span class="num">false</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x19</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'k'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_king</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x1a</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'q'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_queen</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x1b</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'n'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_knight</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x1c</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'b'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_bishop</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x1d</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'r'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_rook</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">case</span> <span class="num">0x1e</span>:<br/>
<span class="in6"></span><span class="var">bd</span>[<span class="var">idx</span>] = <span class="str">'p'</span>;<br/>
<span class="in6"></span><span class="var">brd</span>.<span class="fn">add_pawn</span>(<span class="var">p</span>, <span class="num">true</span>);<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span><span class="keyword">default</span>:<br/>
<span class="in6"></span><span class="fn">fail</span>(<span class="str">"unknown setup piece "</span> + <span class="fn">to_str</span>(<span class="var">piece</span>));<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">for</span> (; <span class="var">cnt</span> &lt; <span class="num">24</span>; ++<span class="var">cnt</span>) { <span class="var">game_file</span>.<span class="fn">get</span>(); }<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[SetUp \"1\"]\n"</span>;<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"[FEN \""</span>;<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">r</span> { <span class="num">8</span> }; <span class="var">r</span> &gt;= <span class="num">1</span>; --<span class="var">r</span>) {<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">spaces</span> { <span class="num">0</span> };<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">r</span> &lt; <span class="num">8</span>) { <span class="type">std</span>::<span class="var">cout</span>.<span class="fn">put</span>(<span class="str">'/'</span>); }<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">f</span> { <span class="num">1</span> }; <span class="var">f</span> &lt;= <span class="num">8</span>; ++<span class="var">f</span>) {<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">idx</span> { (<span class="var">r</span> - <span class="num">1</span>) * <span class="num">8</span> + (<span class="var">f</span> - <span class="num">1</span>) };<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">bd</span>[<span class="var">idx</span>]) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">spaces</span>) { <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">spaces</span>; <span class="var">spaces</span> = <span class="num">0</span>; }<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cout</span>.<span class="fn">put</span>(<span class="var">bd</span>[<span class="var">idx</span>]);<br/>
<span class="in4"></span>} <span class="keyword">else</span> {<br/>
<span class="in5"></span>++<span class="var">spaces</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">spaces</span>) { <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">spaces</span>; }<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span> &lt;&lt; (<span class="var">start_with_white</span> ? <span class="str">'w'</span> : <span class="str">'b'</span>);<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\"]\n"</span>;<br/>
<span class="in2"></span><span class="keyword">if</span> (! <span class="var">start_with_white</span>) {<br/>
<span class="in3"></span><span class="var">brd</span>.<span class="fn">switch_players</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="keyword">static</span> <span class="var">short</span> <span class="type">MoveNumberLookup</span>[<span class="num">256</span>] = {<br/>
   <span class="num">0xa2</span>, <span class="num">0x95</span>, <span class="num">0x43</span>, <span class="num">0xf5</span>, <span class="num">0xc1</span>, <span class="num">0x3d</span>, <span class="num">0x4a</span>, <span class="num">0x6c</span>, //   <span class="num">0</span> -   <span class="num">7</span><br/>
   <span class="num">0x53</span>, <span class="num">0x83</span>, <span class="num">0xcc</span>, <span class="num">0x7c</span>, <span class="num">0xff</span>, <span class="num">0xae</span>, <span class="num">0x68</span>, <span class="num">0xad</span>, //   <span class="num">8</span> -  <span class="num">15</span><br/>
   <span class="num">0xd1</span>, <span class="num">0x92</span>, <span class="num">0x8b</span>, <span class="num">0x8d</span>, <span class="num">0x35</span>, <span class="num">0x81</span>, <span class="num">0x5e</span>, <span class="num">0x74</span>, //  <span class="num">16</span> -  <span class="num">23</span><br/>
   <span class="num">0x26</span>, <span class="num">0x8e</span>, <span class="num">0xab</span>, <span class="num">0xca</span>, <span class="num">0xfd</span>, <span class="num">0x9a</span>, <span class="num">0xf3</span>, <span class="num">0xa0</span>, //  <span class="num">24</span> -  <span class="num">31</span><br/>
   <span class="num">0xa5</span>, <span class="num">0x15</span>, <span class="num">0xfc</span>, <span class="num">0xb1</span>, <span class="num">0x1e</span>, <span class="num">0xed</span>, <span class="num">0x30</span>, <span class="num">0xea</span>, //  <span class="num">32</span> -  <span class="num">39</span><br/>
   <span class="num">0x22</span>, <span class="num">0xeb</span>, <span class="num">0xa7</span>, <span class="num">0xcd</span>, <span class="num">0x4e</span>, <span class="num">0x6f</span>, <span class="num">0x2e</span>, <span class="num">0x24</span>, //  <span class="num">40</span> -  <span class="num">47</span><br/>
   <span class="num">0x32</span>, <span class="num">0x94</span>, <span class="num">0x41</span>, <span class="num">0x8c</span>, <span class="num">0x6e</span>, <span class="num">0x58</span>, <span class="num">0x82</span>, <span class="num">0x50</span>, //  <span class="num">48</span> -  <span class="num">55</span><br/>
   <span class="num">0xbb</span>, <span class="num">0x02</span>, <span class="num">0x8a</span>, <span class="num">0xd8</span>, <span class="num">0xfa</span>, <span class="num">0x60</span>, <span class="num">0xde</span>, <span class="num">0x52</span>, //  <span class="num">56</span> -  <span class="num">63</span><br/>
   <span class="num">0xba</span>, <span class="num">0x46</span>, <span class="num">0xac</span>, <span class="num">0x29</span>, <span class="num">0x9d</span>, <span class="num">0xd7</span>, <span class="num">0xdf</span>, <span class="num">0x08</span>, //  <span class="num">64</span> -  <span class="num">71</span><br/>
   <span class="num">0x21</span>, <span class="num">0x01</span>, <span class="num">0x66</span>, <span class="num">0xa3</span>, <span class="num">0xf1</span>, <span class="num">0x19</span>, <span class="num">0x27</span>, <span class="num">0xb5</span>, //  <span class="num">72</span> -  <span class="num">79</span><br/>
   <span class="num">0x91</span>, <span class="num">0xd5</span>, <span class="num">0x42</span>, <span class="num">0x0e</span>, <span class="num">0xb4</span>, <span class="num">0x4c</span>, <span class="num">0xd9</span>, <span class="num">0x18</span>, //  <span class="num">80</span> -  <span class="num">87</span><br/>
   <span class="num">0x5f</span>, <span class="num">0xbc</span>, <span class="num">0x25</span>, <span class="num">0xa6</span>, <span class="num">0x96</span>, <span class="num">0x04</span>, <span class="num">0x56</span>, <span class="num">0x6a</span>, //  <span class="num">88</span> -  <span class="num">95</span><br/>
   <span class="num">0xaa</span>, <span class="num">0x33</span>, <span class="num">0x1c</span>, <span class="num">0x2b</span>, <span class="num">0x73</span>, <span class="num">0xf0</span>, <span class="num">0xdd</span>, <span class="num">0xa4</span>, //  <span class="num">96</span> - <span class="num">103</span><br/>
   <span class="num">0x37</span>, <span class="num">0xd3</span>, <span class="num">0xc5</span>, <span class="num">0x10</span>, <span class="num">0xbf</span>, <span class="num">0x5a</span>, <span class="num">0x23</span>, <span class="num">0x34</span>, // <span class="num">104</span> - <span class="num">111</span><br/>
   <span class="num">0x75</span>, <span class="num">0x5b</span>, <span class="num">0xb8</span>, <span class="num">0x55</span>, <span class="num">0xd2</span>, <span class="num">0x6b</span>, <span class="num">0x09</span>, <span class="num">0x3a</span>, // <span class="num">112</span> - <span class="num">119</span><br/>
   <span class="num">0x57</span>, <span class="num">0x12</span>, <span class="num">0xb3</span>, <span class="num">0x77</span>, <span class="num">0x48</span>, <span class="num">0x85</span>, <span class="num">0x9b</span>, <span class="num">0x0f</span>, // <span class="num">120</span> - <span class="num">127</span><br/>
   <span class="num">0x9e</span>, <span class="num">0xc7</span>, <span class="num">0xc8</span>, <span class="num">0xa1</span>, <span class="num">0x7f</span>, <span class="num">0x7a</span>, <span class="num">0xc0</span>, <span class="num">0xbd</span>, // <span class="num">128</span> - <span class="num">135</span><br/>
   <span class="num">0x31</span>, <span class="num">0x6d</span>, <span class="num">0xf6</span>, <span class="num">0x3e</span>, <span class="num">0xc3</span>, <span class="num">0x11</span>, <span class="num">0x71</span>, <span class="num">0xce</span>, // <span class="num">136</span> - <span class="num">143</span><br/>
   <span class="num">0x7d</span>, <span class="num">0xda</span>, <span class="num">0xa8</span>, <span class="num">0x54</span>, <span class="num">0x90</span>, <span class="num">0x97</span>, <span class="num">0x1f</span>, <span class="num">0x44</span>, // <span class="num">144</span> - <span class="num">151</span><br/>
   <span class="num">0x40</span>, <span class="num">0x16</span>, <span class="num">0xc9</span>, <span class="num">0xe3</span>, <span class="num">0x2c</span>, <span class="num">0xcb</span>, <span class="num">0x84</span>, <span class="num">0xec</span>, // <span class="num">152</span> - <span class="num">159</span><br/>
   <span class="num">0x9f</span>, <span class="num">0x3f</span>, <span class="num">0x5c</span>, <span class="num">0xe6</span>, <span class="num">0x76</span>, <span class="num">0x0b</span>, <span class="num">0x3c</span>, <span class="num">0x20</span>, // <span class="num">160</span> - <span class="num">167</span><br/>
   <span class="num">0xb7</span>, <span class="num">0x36</span>, <span class="num">0x00</span>, <span class="num">0xdc</span>, <span class="num">0xe7</span>, <span class="num">0xf9</span>, <span class="num">0x4f</span>, <span class="num">0xf7</span>, // <span class="num">168</span> - <span class="num">175</span><br/>
   <span class="num">0xaf</span>, <span class="num">0x06</span>, <span class="num">0x07</span>, <span class="num">0xe0</span>, <span class="num">0x1a</span>, <span class="num">0x0a</span>, <span class="num">0xa9</span>, <span class="num">0x4b</span>, // <span class="num">176</span> - <span class="num">183</span><br/>
   <span class="num">0x0c</span>, <span class="num">0xd6</span>, <span class="num">0x63</span>, <span class="num">0x87</span>, <span class="num">0x89</span>, <span class="num">0x1d</span>, <span class="num">0x13</span>, <span class="num">0x1b</span>, // <span class="num">184</span> - <span class="num">191</span><br/>
   <span class="num">0xe4</span>, <span class="num">0x70</span>, <span class="num">0x05</span>, <span class="num">0x47</span>, <span class="num">0x67</span>, <span class="num">0x7b</span>, <span class="num">0x2f</span>, <span class="num">0xee</span>, // <span class="num">192</span> - <span class="num">199</span><br/>
   <span class="num">0xe2</span>, <span class="num">0xe8</span>, <span class="num">0x98</span>, <span class="num">0x0d</span>, <span class="num">0xef</span>, <span class="num">0xcf</span>, <span class="num">0xc4</span>, <span class="num">0xf4</span>, // <span class="num">200</span> - <span class="num">207</span><br/>
   <span class="num">0xfb</span>, <span class="num">0xb0</span>, <span class="num">0x17</span>, <span class="num">0x99</span>, <span class="num">0x64</span>, <span class="num">0xf2</span>, <span class="num">0xd4</span>, <span class="num">0x2a</span>, // <span class="num">208</span> - <span class="num">215</span><br/>
   <span class="num">0x03</span>, <span class="num">0x4d</span>, <span class="num">0x78</span>, <span class="num">0xc6</span>, <span class="num">0xfe</span>, <span class="num">0x65</span>, <span class="num">0x86</span>, <span class="num">0x88</span>, // <span class="num">216</span> - <span class="num">223</span><br/>
   <span class="num">0x79</span>, <span class="num">0x45</span>, <span class="num">0x3b</span>, <span class="num">0xe5</span>, <span class="num">0x49</span>, <span class="num">0x8f</span>, <span class="num">0x2d</span>, <span class="num">0xb9</span>, // <span class="num">224</span> - <span class="num">231</span><br/>
   <span class="num">0xbe</span>, <span class="num">0x62</span>, <span class="num">0x93</span>, <span class="num">0x14</span>, <span class="num">0xe9</span>, <span class="num">0xd0</span>, <span class="num">0x38</span>, <span class="num">0x9c</span>, // <span class="num">232</span> - <span class="num">239</span><br/>
   <span class="num">0xb2</span>, <span class="num">0xc2</span>, <span class="num">0x59</span>, <span class="num">0x5d</span>, <span class="num">0xb6</span>, <span class="num">0x72</span>, <span class="num">0x51</span>, <span class="num">0xf8</span>, // <span class="num">240</span> - <span class="num">247</span><br/>
    <span class="num">0x28</span>, <span class="num">0x7e</span>, <span class="num">0x61</span>, <span class="num">0x39</span>, <span class="num">0xe1</span>, <span class="num">0xdb</span>, <span class="num">0x69</span>, <span class="num">0x80</span>, // <span class="num">248</span> - <span class="num">255</span><br/>
 	};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">chrs</span> { <span class="num">1000</span> };<br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">int</span> <span class="var">count</span> { <span class="num">0</span> }, <span class="var">nr</span> { <span class="num">0</span> }; <span class="var">len</span>; ++<span class="var">count</span>, ++<span class="var">nr</span>, --<span class="var">len</span>) {<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">ch</span> { (<span class="var">game_file</span>.<span class="fn">get</span>() - <span class="var">count</span>) &amp; <span class="num">0xff</span> };<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="num">0x0c</span>) {<br/>
<span class="in3"></span><span class="keyword">break</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostringstream</span> <span class="var">out</span>;<br/>
<span class="in2"></span><span class="keyword">if</span> (! (<span class="var">nr</span> &amp; <span class="num">1</span>)) {<br/>
<span class="in3"></span><span class="var">out</span> &lt;&lt; (<span class="num">1</span> + (<span class="var">nr</span> &gt;&gt; <span class="num">1</span>)) &lt;&lt; <span class="str">". "</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">'{'</span> &lt;&lt; <span class="type">std</span>::<span class="var">hex</span> &lt;&lt; <span class="var">ch</span> &lt;&lt; <span class="type">std</span>::<span class="var">dec</span> &lt;&lt; <span class="str">"} "</span>;<br/>
<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">ch</span>) {<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x00</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x01</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x02</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x04</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x05</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x06</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x07</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x08</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x09</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">6</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0a</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0b</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">4</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0e</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x0f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x10</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x11</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x12</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">8</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x13</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">8</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x14</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x15</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">5</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x16</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x17</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x18</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x19</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">8</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x1a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x1b</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x1d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x1f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x20</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x21</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x23</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x24</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x26</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x27</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x28</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x29</span>: {<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">mv</span> { <span class="type">MoveNumberLookup</span>[(<span class="var">game_file</span>.<span class="fn">get</span>() - <span class="var">count</span>) &amp; <span class="num">0xff</span>] };<br/>
<span class="in4"></span><span class="var">mv</span> = (<span class="var">mv</span> &lt;&lt; <span class="num">8</span>) | <span class="type">MoveNumberLookup</span>[(<span class="var">game_file</span>.<span class="fn">get</span>() - <span class="var">count</span>) &amp; <span class="num">0xff</span>];<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">from</span> { <span class="var">mv</span> &amp; <span class="num">0x3f</span> };<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">to</span> { (<span class="var">mv</span> &gt;&gt; <span class="num">6</span>) &amp; <span class="num">0x3f</span> };<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">prom</span> { (<span class="var">mv</span> &gt;&gt; <span class="num">12</span>) &amp; <span class="num">0x3</span> };<br/>
<span class="in4"></span><span class="type">Piece</span> *<span class="var">from_piece</span> { <span class="var">brd</span>.<span class="fn">get</span>(<span class="type">Position</span> {(<span class="var">from</span> &gt;&gt; <span class="num">3</span>) + <span class="num">1</span>, <span class="var">from</span> % <span class="num">8</span> + <span class="num">1</span> }) };<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">from_piece</span>) {<br/>
<span class="in5"></span><span class="fn">fail</span>(<span class="str">"no from piece at: "</span> + (<span class="type">std</span>::<span class="type">string</span>) <span class="type">Position</span> { (<span class="var">from</span> &gt;&gt; <span class="num">3</span>) + <span class="num">1</span>, <span class="var">from</span> % <span class="num">8</span> + <span class="num">1</span> });<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="type">Position</span> <span class="var">top</span> { (<span class="var">to</span> &gt;&gt; <span class="num">3</span>) + <span class="num">1</span>, <span class="var">to</span> % <span class="num">8</span> + <span class="num">1</span>};<br/>
<span class="in4"></span><span class="keyword">if</span> (! <span class="var">top</span>) {<br/>
<span class="in5"></span><span class="fn">fail</span>(<span class="str">"no to position "</span> + <span class="fn">to_str</span>(<span class="var">to</span> &gt;&gt; <span class="num">3</span>) + <span class="str">", "</span> + <span class="fn">to_str</span>(<span class="var">to</span> % <span class="num">8</span>));<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">from_piece</span>-&gt;<span class="fn">pawn</span>() &amp;&amp; (<span class="var">top</span>.<span class="fn">rank</span>() == <span class="num">1</span> || <span class="var">top</span>.<span class="fn">rank</span>() == <span class="num">8</span>)) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">top</span>.<span class="fn">file</span>() != <span class="var">from_piece</span>-&gt;<span class="fn">file</span>()) {<br/>
<span class="in6"></span><span class="var">out</span> &lt;&lt; <span class="var">from_piece</span>-&gt;<span class="fn">file_str</span>() &lt;&lt; <span class="str">'x'</span>;<br/>
<span class="in6"></span><span class="type">Piece</span> *<span class="var">old</span> = <span class="var">brd</span>.<span class="fn">get</span>(<span class="var">top</span>);<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">old</span>) { <span class="var">brd</span>.<span class="fn">remove</span>(<span class="var">old</span>); }<br/>
<span class="in5"></span>}<br/>
<span class="in5"></span><span class="var">from_piece</span>-&gt;<span class="fn">file</span>(<span class="num">0</span>);<br/>
<span class="in5"></span><span class="var">from_piece</span>-&gt;<span class="fn">rank</span>(<span class="num">0</span>);<br/>
<span class="in5"></span><span class="type">Piece</span> *<span class="var">to_piece</span> { <span class="num">nullptr</span> };<br/>
<span class="in5"></span><span class="keyword">switch</span> (<span class="var">prom</span>) {<br/>
<span class="in6"></span><span class="keyword">case</span> <span class="num">0</span>:<br/>
<span class="in7"></span><span class="var">to_piece</span> = <span class="var">brd</span>.<span class="fn">add_queen</span>(<span class="var">top</span>);<br/>
<span class="in7"></span><span class="keyword">break</span>;<br/>
<span class="in6"></span><span class="keyword">case</span> <span class="num">1</span>:<br/>
<span class="in7"></span><span class="var">to_piece</span> = <span class="var">brd</span>.<span class="fn">add_rook</span>(<span class="var">top</span>);<br/>
<span class="in7"></span><span class="keyword">break</span>;<br/>
<span class="in6"></span><span class="keyword">case</span> <span class="num">2</span>:<br/>
<span class="in7"></span><span class="var">to_piece</span> = <span class="var">brd</span>.<span class="fn">add_bishop</span>(<span class="var">top</span>);<br/>
<span class="in7"></span><span class="keyword">break</span>;<br/>
<span class="in6"></span><span class="keyword">case</span> <span class="num">3</span>:<br/>
<span class="in7"></span><span class="var">to_piece</span> = <span class="var">brd</span>.<span class="fn">add_knight</span>(<span class="var">top</span>);<br/>
<span class="in7"></span><span class="keyword">break</span>;<br/>
<span class="in6"></span><span class="keyword">default</span>:<br/>
<span class="in7"></span><span class="fn">fail</span>(<span class="str">"unknown promotion piece "</span> + <span class="fn">to_str</span>(<span class="var">prom</span>));<br/>
<span class="in5"></span>}<br/>
<span class="in5"></span><span class="var">out</span> &lt;&lt; (<span class="type">std</span>::<span class="type">string</span>) <span class="var">top</span> &lt;&lt; <span class="str">"="</span> &lt;&lt; <span class="var">to_piece</span>-&gt;<span class="fn">name</span>();<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">brd</span>.<span class="fn">check</span>()) {<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">brd</span>.<span class="fn">mate</span>()) {<br/>
<span class="in7"></span><span class="var">out</span> &lt;&lt; <span class="str">'#'</span>;<br/>
<span class="in6"></span>} <span class="keyword">else</span> {<br/>
<span class="in7"></span><span class="var">out</span> &lt;&lt; <span class="str">'+'</span>;<br/>
<span class="in6"></span>}<br/>
<span class="in5"></span>}<br/>
<span class="in5"></span><span class="keyword">break</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="var">brd</span>.<span class="fn">move</span>(<span class="var">out</span>, <span class="var">brd</span>.<span class="fn">first</span>(*<span class="var">from_piece</span>), <span class="var">from_piece</span>, <span class="var">top</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2b</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2c</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2d</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2e</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x2f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x30</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x31</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x32</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x33</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">8</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x34</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x35</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x36</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">5</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x37</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x38</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x39</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3a</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">7</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3b</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3d</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3e</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x3f</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x40</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x41</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x42</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x43</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x44</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x45</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x46</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x47</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, -<span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x48</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x49</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4a</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4b</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4e</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x4f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x50</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x51</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x52</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x53</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x54</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x55</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x56</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x57</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x58</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x59</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5b</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5c</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5d</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, <span class="num">1</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5e</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x5f</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x60</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x61</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x62</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x63</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x64</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x66</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x67</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x68</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x69</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6b</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6c</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6d</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6e</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x6f</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x70</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x71</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x72</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x73</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x74</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x75</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x76</span>:<br/>
<span class="in4"></span><span class="var">brd</span>.<span class="fn">kingside_rochade</span>(<span class="var">out</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x77</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x78</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x79</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7a</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7b</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7c</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7d</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">6</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7e</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x7f</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x80</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x81</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x82</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x83</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x84</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">5</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x85</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x86</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x87</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x88</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x89</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8b</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8c</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8d</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8e</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x8f</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x90</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">4</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x91</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x92</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x93</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x94</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x95</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x96</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x97</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x98</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x99</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9a</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9b</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9c</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9d</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9e</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">6</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0x9f</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">" {!!} "</span>;<br/>
<span class="in4"></span>--<span class="var">count</span>; --<span class="var">nr</span>;<br/>
<span class="in4"></span><span class="keyword">continue</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa0</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa1</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa3</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa2</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa4</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa5</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa7</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa8</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xa9</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xaa</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">" {!!} "</span>;<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xab</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xac</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xae</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb0</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb1</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, -<span class="num">1</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb2</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, -<span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb3</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb4</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb5</span>:<br/>
<span class="in4"></span><span class="var">brd</span>.<span class="fn">queenside_rochade</span>(<span class="var">out</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb6</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb7</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb8</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xb9</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xba</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbb</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">7</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbc</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">7</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbd</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbe</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xbf</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc0</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc1</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc2</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, <span class="num">0</span>, -<span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc3</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">5</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc4</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc5</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">4</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc8</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xc9</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xca</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xcb</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xcd</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">2</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xce</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd1</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd2</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd3</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">4</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd4</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd7</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd8</span>:<br/>
<span class="in4"></span><span class="fn">move_king</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xd9</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">4</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xdb</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xde</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">6</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xda</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xdd</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">1</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xdf</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">7</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe0</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe1</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">3</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe2</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe3</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe4</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe5</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe6</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe7</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe8</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xe9</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">6</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xea</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xeb</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xec</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xed</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xee</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">4</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xef</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf0</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">1</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf1</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">3</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf2</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">2</span>, <span class="num">6</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf3</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf4</span>:<br/>
<span class="in4"></span><span class="fn">move_queen</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">5</span>, <span class="num">0</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf5</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf6</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">1</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf8</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xf9</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">4</span>, <span class="num">7</span>, <span class="num">1</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfa</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">1</span>, <span class="num">7</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfb</span>:<br/>
<span class="in4"></span><span class="fn">move_rook</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">0</span>, <span class="num">5</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfc</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">6</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfe</span>:<br/>
<span class="in4"></span><span class="fn">move_knight</span>(<span class="var">out</span>, <span class="num">2</span>, <span class="num">7</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xfd</span>:<br/>
<span class="in4"></span><span class="fn">move_bishop</span>(<span class="var">out</span>, <span class="num">3</span>, <span class="num">7</span>, <span class="num">7</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="num">0xff</span>:<br/>
<span class="in4"></span><span class="fn">move_pawn</span>(<span class="var">out</span>, <span class="num">5</span>, <span class="num">0</span>, <span class="num">2</span>);<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">default</span>:<br/>
<span class="in4"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">code</span>;<br/>
<span class="in4"></span><span class="type">const</span> <span class="type">char</span> <span class="var">digits</span>[] = <span class="str">"0123456789abcdef"</span>;<br/>
<span class="in4"></span><span class="var">code</span> += <span class="var">digits</span>[<span class="var">ch</span> &gt;&gt; <span class="num">4</span>];<br/>
<span class="in4"></span><span class="var">code</span> += <span class="var">digits</span>[<span class="var">ch</span> &amp; <span class="num">0xf</span>];<br/>
<span class="in4"></span><span class="fn">fail</span>(<span class="str">"unknown code 0x"</span> + <span class="var">code</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">chrs</span> + <span class="var">out</span>.<span class="fn">str</span>().<span class="fn">size</span>() &gt; <span class="num">79</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">"\n"</span>;<br/>
<span class="in3"></span><span class="var">chrs</span> = <span class="num">0</span>;<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="var">chrs</span> += <span class="num">1</span>;<br/>
<span class="in3"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="str">' '</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">chrs</span> += <span class="var">out</span>.<span class="fn">str</span>().<span class="fn">size</span>();<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cout</span> &lt;&lt; <span class="var">out</span>.<span class="fn">str</span>();<br/>
<span class="in2"></span><span class="var">brd</span>.<span class="fn">switch_players</span>();<br/>
<span class="in1"></span>}<br/>
} <span class="macro">@end(<span class="name">process moves</span>)</span><br/>
</code></div>
</div>
</body>
</html>
